# Dynamic Birth Time Rectification Specï¼ˆäº¤å‹å¹³å°ï¼‰

> ç›®æ¨™ï¼šå…è¨±ä½¿ç”¨è€…ä¸çŸ¥é“ç²¾ç¢ºå‡ºç”Ÿæ™‚é–“ä¹Ÿèƒ½å®Œæˆè¨»å†Šèˆ‡åª’åˆï¼Œä¸¦é€éå¾ŒçºŒå•ç­”èˆ‡äº’å‹•é€æ­¥æ ¡æ­£ï¼ˆrectifyï¼‰å‡ºç”Ÿæ™‚é–“ï¼Œè®“é«˜ç²¾åº¦åŠŸèƒ½é€æ­¥è§£é–ã€‚
> 

---

## 1. ç¯„åœèˆ‡åè©

### 1.1 ç¯„åœï¼ˆIn scopeï¼‰

- è¨»å†Šèˆ‡è³‡æ–™æ”¶é›†ï¼ˆå‡ºç”Ÿæ—¥æœŸã€å‡ºç”Ÿåœ°ã€å‡ºç”Ÿæ™‚é–“ç²¾åº¦ï¼‰
- å‡ºç”Ÿæ™‚é–“ä¸ç¢ºå®šæ™‚çš„è³‡æ–™è¡¨ç¤ºï¼ˆå€é–“èˆ‡ä¿¡å¿ƒå€¼ï¼‰
- æ ¡æ­£æµç¨‹ï¼ˆå…ˆç²—å¾Œç´°ï¼‰
- æ ¡æ­£å®Œæˆå‰å¾Œï¼Œå°å¤–è¼¸å‡ºå¦‚ä½•é™ç´šå‘ˆç¾ï¼ˆTier/æ¬Šé™ï¼‰
- å¾Œç«¯æ¨¡çµ„åˆ‡åˆ†ï¼ˆRectificationService / AstrologyEngineï¼‰

### 1.2 åè©

- **Provided Time**ï¼šä½¿ç”¨è€…è¼¸å…¥çš„æ™‚é–“ï¼ˆå¯èƒ½ä¸å­˜åœ¨æˆ–ä¸ç²¾ç¢ºï¼‰
- **Active Range**ï¼šç›®å‰ç³»çµ±èªå®šã€ŒçœŸå¯¦å‡ºç”Ÿæ™‚é–“å¯èƒ½è½åœ¨çš„å€é–“ã€
- **Candidate**ï¼šåœ¨ Active Range å…§åˆ‡å‡ºçš„å€™é¸æ™‚é–“æ®µï¼ˆä¾‹å¦‚ D9 slotsï¼‰
- **Confidence**ï¼šç³»çµ±å°ç›®å‰æ ¡æ­£çµæœçš„ä¿¡å¿ƒæŒ‡æ•¸ï¼ˆ0.0 - 1.0ï¼‰
- **Boundary Case**ï¼šè½åœ¨äº¤ç•Œé™„è¿‘ï¼Œå¾®å°èª¤å·®å¯èƒ½é€ æˆç›¤é¢å¤§è®Šå‹•çš„æ¡ˆä¾‹

---

## 2. ç›®æ¨™èˆ‡è¨­è¨ˆåŸå‰‡ï¼ˆWhyï¼‰

### 2.1 ç”¢å“ç›®æ¨™

- ä½¿ç”¨è€…å³ä½¿ã€Œä¸çŸ¥é“ç²¾ç¢ºå‡ºç”Ÿæ™‚é–“ã€ä¹Ÿèƒ½å¾—åˆ°å¯ç”¨çš„é…å°çµæœã€‚
- ç³»çµ±èƒ½ç”¨å¾ŒçºŒäº’å‹•è¨Šè™Ÿï¼ŒæŠŠå‡ºç”Ÿæ™‚é–“å¾ã€Œæ¨¡ç³Šã€é€æ­¥æ”¶æ–‚åˆ°ã€Œå¯ç”¨ã€ç”šè‡³ã€Œé–å®šã€ã€‚
- ç³»çµ±éœ€å…·å‚™å¯è¿½æº¯æ€§ï¼šèƒ½å›ç­”ã€Œç‚ºä»€éº¼æ™‚é–“å¾ A è®Šæˆ Bã€ã€‚

### 2.2 è¨­è¨ˆåŸå‰‡

- **ä¸è¦å¼·è¿«ç²¾ç¢º**ï¼šä»¥åˆ†ç´šï¼ˆTierï¼‰ï¼‹è§£é–å¼•å°æå‡è³‡æ–™å“è³ªã€‚
- **æ°¸é ä»¥å€é–“è¡¨ç¤ºä¸ç¢ºå®šæ€§**ï¼šé¿å…åœ¨è³‡æ–™å±¤å°±å‡è£ç²¾ç¢ºã€‚
- **å°å¤–å‘ˆç¾é¿å…çµ•å°èªæ°£**ï¼šç”¨å€é–“ã€é›·é”ã€æ¨™ç±¤ã€å¯èƒ½æ€§ã€‚
- **æ ¡æ­£å¯é‡è·‘**ï¼šæ‰€æœ‰æ ¡æ­£è¼¸å…¥èˆ‡æ±ºç­–è¦æœ‰ logã€‚

### 2.3 æ ¡æ­£å•ç­”è¨­è¨ˆå“²å­¸ï¼šVia Negativaï¼ˆåå•ï¼å¦å®šæ³•ï¼‰

> æ ¸å¿ƒï¼šæ¯”èµ·ã€Œä½ å–œæ­¡ä»€éº¼ã€ï¼Œäººå°ã€Œä½ çµ•å°ç„¡æ³•å¿å—ä»€éº¼ã€æ›´æœ‰æŠŠæ¡ã€‚æ ¡æ­£æ™‚ç”¨æ’é™¤æ³•èƒ½æ›´å¿«æ”¶æ–‚ï¼Œä¸”æ›´èƒ½é¿å…å·´å—æ•ˆæ‡‰é€ æˆçš„å¼±è¨Šè™Ÿã€‚
> 

**æ ¸å¿ƒå‡è¨­ï¼ˆStrong signal over weak signalï¼‰**

- **æ­£å‘å•é¡Œï¼ˆå¼±è¨Šè™Ÿï¼‰ï¼š** ä¾‹å¦‚ã€Œä½ å–œæ­¡æ€è€ƒå—ï¼Ÿã€å¤šæ•¸äººæœƒå›ç­”ã€Œå–œæ­¡ã€ã€‚
- **åå‘å•é¡Œï¼ˆå¼·è¨Šè™Ÿï¼‰ï¼š** ä¾‹å¦‚ã€Œè¢«å¼·è¿«åƒåŠ ä¸€å€‹å……æ»¿ç¬¨è›‹çš„ç¤¾äº¤èšæœƒï¼Œä½ æœƒå´©æ½°å—ï¼Ÿã€åªæœ‰ç‰¹å®šäººæ ¼é…ç½®æœƒç”¢ç”Ÿæ¥µå¼·åæ‡‰ã€‚

**æ ¡æ­£ç­–ç•¥**

- **Stress Testï¼ˆå£“åŠ›æ¸¬è©¦ï¼‰ï¼š** ä¸å•åå¥½ç’°å¢ƒï¼Œè€Œå•ã€Œå“ªç¨®æƒ…å¢ƒæœƒè®“ä½ ç†æ™ºæ–·ç·šã€ã€‚
- **Visual Exclusionï¼ˆå¤–å‹ï¼æ°£è³ªæ’é™¤ï¼‰ï¼š** ä¸ç›´æ¥å•ã€Œä½ é•·æ€æ¨£ã€ï¼Œè€Œå•ã€Œåˆ¥äººçµ•å°ä¸æœƒç”¨å“ªå€‹å½¢å®¹è©å½¢å®¹ä½ ã€ã€‚

**UX åŒ…è£ï¼ˆåŒç†å¼åå•ï¼‰**

- ä¸è¦å¯«ã€Œè«‹æ’é™¤éŒ¯èª¤é¸é …ã€ã€‚
- å»ºè­°æ–‡æ¡ˆï¼š
    - **ã€Œæˆ‘å€‘çŸ¥é“ï¼Œæ¯”èµ·å–œæ­¡ä»€éº¼ï¼Œä½ æ›´æ¸…æ¥šè‡ªå·±è¨å­ä»€éº¼ã€‚ã€**
    - *ã€Œç‚ºäº†å¹«ä½ æ‰¾åˆ°æœ€ç²¾æº–çš„æ˜Ÿç›¤ï¼Œè«‹å‘Šè¨´æˆ‘å€‘ï¼Œå“ªä¸€å€‹æè¿°æ˜¯ä½ çµ•å°ç„¡æ³•æ¥å—ï¼Œæˆ–çµ•å°ä¸ç¬¦åˆä½ çš„ï¼Ÿã€*

---

## 3. è¨»å†Šèˆ‡è³‡æ–™æ”¶é›† SOPï¼ˆå‰ç«¯æµç¨‹ï¼‰

### 3.1 è¨»å†Šæœ€å°å¿…å¡«ï¼ˆMVPï¼‰

- å‡ºç”Ÿæ—¥æœŸï¼šYYYY-MM-DD
- å‡ºç”Ÿåœ°ï¼šåŸå¸‚ï¼ˆå¾Œç«¯éœ€å¯è§£ææˆç¶“ç·¯åº¦ï¼‰
- å‡ºç”Ÿæ™‚é–“ï¼šå…è¨±ä»¥ä¸‹ç²¾åº¦ä¹‹ä¸€
    - **PRECISE**ï¼šç²¾ç¢ºåˆ° HH:mm
    - **TWO_HOUR_SLOT**ï¼š2 å°æ™‚å€é–“ï¼ˆä¾‹å¦‚ 13:00-15:00ï¼‰ï¼Œä»¥ä¸€èˆ¬æ™‚æ®µå‘ˆç¾
    - **FUZZY_DAY**ï¼šåŒ…å«ä»¥ä¸‹å­åˆ†é¡
        - `morning`ï¼ˆ06:00-12:00ï¼‰
        - `afternoon`ï¼ˆ12:00-18:00ï¼‰
        - `evening`ï¼ˆ18:00-24:00ï¼‰
        - `unknown`ï¼ˆ00:00-24:00ï¼Œå®Œå…¨ä¸çŸ¥é“ï¼‰

### 3.2 åˆ†æµå¼•å°ï¼ˆUX â€” Card-style Guided Flowï¼‰

> UX èªè¨€ä¿æŒç¾ä»£ã€è³¦èƒ½æ„Ÿï¼Œé¿å…ã€Œç®—å‘½ã€æ°›åœã€‚æ™‚é–“é¸é …ç”¨ä¸€èˆ¬æ™‚æ®µå‘ˆç¾ï¼ˆ01:00-03:00ï¼‰ï¼Œä¸åˆ»æ„ä½¿ç”¨å‚³çµ±æ™‚è¾°åç¨±ã€‚

å…ˆä»¥ 4 å¼µå¯é»é¸çš„å¡ç‰‡è©¢å•ï¼šã€Œä½ å°å‡ºç”Ÿæ™‚é–“çš„äº†è§£ç¨‹åº¦ï¼Ÿã€

| Card | Icon | Title | Sub-label | accuracy_type | Next action |
|------|------|-------|-----------|---------------|-------------|
| A | `verified` | æˆ‘æœ‰ç²¾ç¢ºæ™‚é–“ | å‡ºç”Ÿè­‰æ˜æˆ–å®¶äººç¢ºèª | `PRECISE` | é¡¯ç¤º time picker (HH:mm) |
| B | `timelapse` | æˆ‘çŸ¥é“å¤§æ¦‚æ™‚æ®µ | ç´„å…©å°æ™‚çš„ç¯„åœ | `TWO_HOUR_SLOT` | é¡¯ç¤º 12 æ ¼ 2hr slot grid |
| C | `wb_twilight` | æˆ‘åªçŸ¥é“å¤§æ¦‚ | æ—©ä¸Šã€ä¸‹åˆæˆ–æ™šä¸Š | `FUZZY_DAY` | é¡¯ç¤º 3 é¸é … |
| D | `help` | æˆ‘å®Œå…¨ä¸çŸ¥é“ | æ²’é—œä¿‚ï¼Œæˆ‘å€‘æœƒå¹«ä½ æ‰¾åˆ° | `FUZZY_DAY` (unknown) | ç›´æ¥é€²å…¥ä¸‹ä¸€æ­¥ |

**TWO_HOUR_SLOT å­é¸æ“‡ï¼ˆ12 æ ¼ Gridï¼‰ï¼š**

```
23:00 - 01:00    01:00 - 03:00    03:00 - 05:00    05:00 - 07:00
07:00 - 09:00    09:00 - 11:00    11:00 - 13:00    13:00 - 15:00
15:00 - 17:00    17:00 - 19:00    19:00 - 21:00    21:00 - 23:00
```

**FUZZY_DAY å­é¸æ“‡ï¼š**

| Option | window_start | window_end | window_size_minutes |
|--------|-------------|-----------|---------------------|
| æ—©ä¸Š | 06:00 | 12:00 | 360 |
| ä¸‹åˆ | 12:00 | 18:00 | 360 |
| æ™šä¸Š | 18:00 | 00:00 | 360 |

### 3.3 å¾Œç«¯é è™•ç†ï¼ˆPreprocessingï¼‰

- **çœŸå¤ªé™½æ™‚ï¼ˆTrue Solar Timeï¼‰è½‰æ›**
    - å¾Œç«¯æ¥æ”¶æ™‚é–“å¾Œï¼Œä¾å‡ºç”Ÿåœ°ç¶“ç·¯åº¦åšè½‰æ›ã€‚
- **Boundary Case æ¨™è¨˜**
    - è‹¥ä½¿ç”¨è€…çš„æ™‚é–“çª—å£æ©«è·¨é—œéµå¤©è±¡åˆ‡æ›é»ï¼Œæ¨™è¨˜ï¼š`isBoundaryCase = true`
    - åµæ¸¬é …ç›®ï¼ˆä¾å½±éŸ¿å„ªå…ˆåº¦æ’åºï¼‰ï¼š
        1. **ä¸Šå‡ï¼ä¸‹é™æ˜Ÿåº§æ›åº§ï¼ˆAscendant/Descendant sign changeï¼‰** â€” ä¸‹é™æ˜Ÿåº§ (Descendant) ä»£è¡¨ã€Œä½ è¢«ä»€éº¼æ¨£çš„äººå¸å¼•ã€ã€ã€Œä½ åœ¨é—œä¿‚ä¸­éœ€è¦ä»€éº¼ã€ï¼Œç‚ºé…å°æ ¸å¿ƒåƒæ•¸ã€‚Ascendant â‰ˆ æ¯ 2hr æ›åº§ï¼ŒDescendant åŒæ­¥æ›åº§ï¼ˆ180Â° å°é¢ï¼‰ã€‚è‹¥çª—å£å…§ Asc/Dsc æ›åº§ï¼Œé…å°é‚è¼¯å¯èƒ½å®Œå…¨ç¿»è½‰ã€‚**æ­¤ç‚ºæœ€é«˜å„ªå…ˆé‚Šç•Œæ¡ˆä¾‹ã€‚**
        2. **BaZi æ™‚æŸ±äº¤ç•Œ** â€” è‹¥çª—å£æ©«è·¨ 2 å°æ™‚æ™‚è¾°é‚Šç•Œï¼ˆå¥‡æ•¸å°æ™‚ï¼š01, 03, 05...ï¼‰ï¼Œæ™‚æŸ±å¯èƒ½æ”¹è®Šã€‚
        3. **æœˆäº®æ›åº§** â€” æœˆäº®æ¯ â‰ˆ2.5 å¤©æ›åº§ï¼Œè‹¥çª—å£ > 2hr ä¸”ç•¶å¤©æœˆäº®å¯èƒ½è·¨åº§ï¼Œæ¨™è¨˜ã€‚
    - Boundary Case reason è¨˜éŒ„æ–¼ `rectification_events` payloadã€‚
    - Boundary Case æœƒæé«˜å¾ŒçºŒæ ¡æ­£é¡Œç›®çš„å„ªå…ˆåº¦ï¼ˆè¦‹ Â§6ï¼‰ã€‚

### 3.4 åˆå§‹ä¿¡å¿ƒå€¼ï¼ˆInitial Confidenceï¼‰

| accuracy_type | condition | initial_confidence | ç†ç”± |
|---------------|-----------|-------------------|------|
| `PRECISE` | æœ‰ç²¾ç¢º HH:mm | 0.90 | é«˜ä½†é 1.0 â€” å‡ºç”Ÿè­‰æ˜å¯èƒ½æœ‰ Â±5min é€²ä½ |
| `TWO_HOUR_SLOT` | é¸æ“‡ 2hr çª—å£ | 0.30 | 1 å€‹æ™‚è¾° = 12 åˆ†ä¹‹ 1 |
| `FUZZY_DAY` | morning/afternoon/evening | 0.15 | 6hr = 3 å€‹æ™‚è¾°å€™é¸ |
| `FUZZY_DAY` | unknown | 0.05 | å…¨å¤© = 12 å€‹æ™‚è¾°å€™é¸ |

---

## 4. è³‡æ–™æ¨¡å‹ï¼ˆData Schemaï¼‰

 æ ¸å¿ƒç†å¿µï¼šä¸è¦åªå­˜å–®ä¸€ `birth_time`ã€‚è‹¥ä¸ç¢ºå®šï¼Œå°±å­˜ **å€é–“** èˆ‡ **ä¿¡å¿ƒå€¼**ã€‚
```typescript
export type AccuracyType = 'PRECISE' | 'TWO_HOUR_SLOT' | 'FUZZY_DAY'

export type RectificationStatus =
	| 'unrectified'
	| 'collecting_signals'
	| 'narrowed_to_2hr'
	| 'narrowed_to_d9'
	| 'locked'
	| 'needs_review'

export interface BirthTimeInput {
	providedTime: string | null; // 'HH:mm' or null
	accuracyType: AccuracyType;
	windowSizeMinutes: number; // 0, 120, 360, 1440...
	windowStart: string | null;   // 'HH:mm' â€” ä½¿ç”¨è€…åŸå§‹å®£å‘Šçš„çª—å£èµ·é»ï¼ˆä¸å¯è®Šï¼Œç”¨æ–¼ audit trailï¼‰
	windowEnd: string | null;     // 'HH:mm' â€” ä½¿ç”¨è€…åŸå§‹å®£å‘Šçš„çª—å£çµ‚é»ï¼ˆä¸å¯è®Šï¼‰
}

export interface RectificationState {
	status: RectificationStatus;
	currentConfidence: number; // 0.0 - 1.0

	// ç³»çµ±ç›®å‰èªå®šçš„å¯èƒ½å€é–“
	activeRangeStart: string; // ISO datetime
	activeRangeEnd: string;   // ISO datetime

	// æœ€çµ‚é–å®šçµæœï¼ˆå¯é¸ï¼‰
	calibratedTime: string | null; // ISO datetime
	activeD9Slot: number | null;   // 1-9

	isBoundaryCase: boolean;
}

export interface RectificationEvent {
	ts: string; // ISO datetime
	source: 'signup' | 'daily_quiz' | 'interaction' | 'post_date_feedback' | 'admin';
	eventType:
		| 'range_initialized'
		| 'range_narrowed'
		| 'candidate_eliminated'
		| 'confidence_updated'
		| 'locked'
		| 'flagged_needs_review';
	payload: Record<string, any>;
}

export interface UserTags {
	dealbreakers: string[]; // ä¾‹å¦‚ ['æš´åŠ›/è¡çª','å†·æ¼ /å£“æŠ‘']
	priorities: 'Achievement' | 'LifeQuality' | null;
}

export interface UserAstrologyProfile {
	birthDate: string; // YYYY-MM-DD
	birthPlace: {
		city: string;
		latitude?: number;
		longitude?: number;
	};

	birthTimeInput: BirthTimeInput;
	rectification: RectificationState;
	rectificationLog: RectificationEvent[];

	userTags: UserTags;
}
```
### 4.2 è³‡æ–™ä¸€è‡´æ€§è¦å‰‡

- `activeRangeStart < activeRangeEnd` å¿…é ˆæˆç«‹ã€‚
- `calibratedTime` åªæœ‰åœ¨ `status = locked` æ™‚å…è¨±é nullã€‚
- `currentConfidence` åƒ…èƒ½ä¸Šå‡æˆ–åœ¨ã€Œneeds_reviewã€æ™‚é‡ç½®ï¼ˆéœ€è¨˜éŒ„åŸå› ï¼‰ã€‚

## 5. æ ¡æ­£æµç¨‹ï¼ˆRectification Flowï¼‰â€”â€”å…ˆç²—å¾Œç´°

### 5.1 æµç¨‹ç¸½è¦½

1. **åˆå§‹åŒ– Active Range**ï¼ˆä¾ä½¿ç”¨è€…è¼¸å…¥ç²¾åº¦ï¼‰
2. **ç²—éæ¿¾ï¼ˆ2 å°æ™‚å±¤ç´šï¼‰**ï¼šæŠŠç¯„åœæ”¶æ–‚åˆ°æŸå€‹æ™‚è¾°æ®µ
3. **ç´°éæ¿¾ï¼ˆD9 slot å±¤ç´šï¼‰**ï¼šåœ¨ 2 å°æ™‚å…§åˆ‡ 9 æ®µï¼Œé€æ­¥æ’é™¤
4. **ä¿¡å¿ƒå€¼æ›´æ–°èˆ‡é–å®š**ï¼šé”é–€æª»å¾Œé€²å…¥ locked

---

## 6. Step Aï¼šç²—éæ¿¾ï¼ˆ2 å°æ™‚å±¤ç´šï¼‰

### 6.1 ç›®çš„

- æŠŠå¤§ç¯„åœï¼ˆFUZZY_DAYï¼‰æˆ–ä¸ç©©å®šçš„æ™‚é–“ï¼Œå…ˆæ”¶æ–‚åˆ°å¯ç”¨çš„ 2 å°æ™‚å€é–“ã€‚
- å„ªå…ˆä½¿ç”¨ã€Œæƒ…ç·’åœ°é›·ï¼å´©æ½°é»ã€åšåˆ‡åˆ†ï¼Œè®“ä½¿ç”¨è€…ç”¨åå•é¡Œæ›´å®¹æ˜“çµ¦å‡ºå¼·è¨Šè™Ÿã€‚

### 6.2 è¼¸å…¥

- `activeRangeStart/End`
- Boundary Case è¨Šè™Ÿï¼ˆä¾‹å¦‚æœˆäº®æ›åº§ã€æ—¥ä¸»å¼·å¼±è·¨ç•Œï¼‰
- ç²—ç²’åº¦å•å·ï¼ˆæœ€å°é›†åˆï¼‰
    - æ ¸å¿ƒåƒ¹å€¼å–å‘ï¼š`Achievement` vs `LifeQuality`ï¼ˆå°æ‡‰ã€Œèº«å®®æ ¡æ­£ã€çš„æŠ½è±¡åˆ¤åˆ¥ï¼‰
    - åå•é¡Œï¼ˆVia Negativaï¼Œå„ªå…ˆåœ¨ Boundary Case æ™‚è§¸ç™¼ï¼‰

### 6.3 ç²—éæ¿¾é¡Œåº«ï¼ˆMVPï¼‰

#### 6.3.1 æœˆäº®æ›åº§æª¢æ¸¬ï¼ˆæƒ…ç·’å´©æ½°é»ï¼‰

> è‹¥å‡ºç”Ÿç•¶å¤©æœˆäº®å¯èƒ½æ›åº§ï¼ˆä¾‹å¦‚ç‰¡ç¾Š â†” é‡‘ç‰›ï¼‰ï¼Œé€™æ˜¯æœ€å¼·åˆ‡åˆ†é»ä¹‹ä¸€ã€‚
> 
- **é¡Œå‹ï¼šWhich is your Nightmare?**
- Q: å¦‚æœå¿…é ˆé¸ä¸€ç¨®ï¼Œä¸‹é¢å“ªç¨®æƒ…æ³æœƒè®“ä½ æ›´æƒ³åŸåœ°çˆ†ç‚¸ï¼Ÿ
    - **é¸é … Aï¼ˆæ’é™¤æœˆäº®ç‰¡ç¾Šï¼åç«è±¡é–‹å‰µï¼‰ï¼š** å‹•ä½œæ…¢ååï¼Œæƒ³åšä»€éº¼éƒ½è¦å±¤å±¤å¯©æ ¸ï¼Œå®Œå…¨æ²’æœ‰è‡ªä¸»æ¬Šã€‚
    - **é¸é … Bï¼ˆæ’é™¤æœˆäº®é‡‘ç‰›ï¼ååœŸè±¡å›ºå®šï¼‰ï¼š** äº‹æƒ…å®Œå…¨å¤±æ§ï¼Œè¨ˆç•«æ”¹äº†åˆæ”¹ï¼Œé‚„è¦é¢å°çªç™¼ç‹€æ³ã€‚
- **åˆ¤æ–·ï¼š**
    - é¸ Aï¼šä¿ç•™ã€Œæœˆäº®åœŸè±¡ï¼å›ºå®šå®®ã€çš„å€™é¸æ™‚æ®µã€‚
    - é¸ Bï¼šä¿ç•™ã€Œæœˆäº®ç«è±¡ï¼é–‹å‰µå®®ã€çš„å€™é¸æ™‚æ®µã€‚

#### 6.3.2 å…«å­—èº«å¼·ï¼èº«å¼±æª¢æ¸¬ï¼ˆç¤¾äº¤è€—èƒ½é»ï¼‰

> è‹¥å‡ºç”Ÿç•¶å¤©è·¨è¶Šæ—¥ä¸»å¼·å¼±ç•Œç·šï¼ˆä¾‹å¦‚æ—©ä¸Šèº«å¼±ã€ä¸‹åˆèº«å¼·ï¼‰ï¼Œå¯ç”¨ç¤¾äº¤è€—èƒ½åšå¿«é€Ÿåˆ†æµã€‚
> 
- **é¡Œå‹ï¼šSocial Battery Drain**
- Q: æ”¾å‡æ™‚è¢«æ‹‰å»åƒåŠ ä¸€å€‹ 10 äººçš„é™Œç”Ÿèšæœƒï¼Œä½ çš„å…§å¿ƒ OS æ˜¯ï¼Ÿ
    - **é¸é … Aï¼ˆæ’é™¤èº«å¼±ï¼‰ï¼š** ã€Œå¥½è€¶ï¼æ­£å¥½å¯ä»¥èªè­˜æ–°æœ‹å‹ï¼Œå±•ç¾æˆ‘çš„é­…åŠ›ã€‚ã€ï¼ˆåèº«å¼·åæ‡‰ï¼‰
    - **é¸é … Bï¼ˆæ’é™¤èº«å¼·ï¼‰ï¼š** ã€Œå¤©å•Šé¥’äº†æˆ‘å§ï¼Œæˆ‘åªæƒ³è¦ä¸€å€‹äººéœéœæˆ–è·Ÿç†Ÿäººå¾…è‘—ã€‚ã€ï¼ˆåèº«å¼±åæ‡‰ï¼‰
- **åˆ¤æ–·ï¼š**
    - é¸ Aï¼šåˆªé™¤ã€Œèº«å¼±ã€æ™‚æ®µã€‚
    - é¸ Bï¼šåˆªé™¤ã€Œèº«å¼·ã€æ™‚æ®µã€‚

### 6.4 è¼¸å‡º

- æ›´æ–° `activeRangeStart/End`ï¼ˆæ¥è¿‘ 2 å°æ™‚ï¼‰
- æ›´æ–° `status = narrowed_to_2hr`
- è¿½åŠ  rectificationLogï¼š`range_narrowed`ï¼ˆéœ€è¨˜éŒ„ï¼šè§¸ç™¼åŸå› ã€é¡Œç›®ç‰ˆæœ¬ã€ä½¿ç”¨è€…é¸é …ã€è¢«æ’é™¤çš„å€™é¸é›†åˆæ‘˜è¦ï¼‰

---

## 7. Step Bï¼šç´°éæ¿¾ï¼ˆD9 slotï¼Œç´„ 13 åˆ†é˜ç²’åº¦ï¼‰

### 7.1 ç›®çš„

- åœ¨ 2 å°æ™‚ç¯„åœå…§åˆ‡åˆ†å€™é¸ï¼ˆ9 å€‹ slotsï¼‰ï¼Œç”¨ã€Œè² é¢éæ¿¾ã€å¿«é€Ÿæ’é™¤ä¸å¯èƒ½çš„å€æ®µã€‚
- é™¤äº†ã€Œé—œä¿‚åœ°é›·ã€ï¼ˆplanet_tags.jsonï¼‰ï¼Œè£œä¸Šä¸€å±¤ã€Œå¤–åœ¨é¢å…·ï¼å·¥ä½œæŠ—å£“ã€çš„åå•é¡Œï¼Œç”¨äº’æ–¥æ¨™ç±¤åšæ›´å¿«çš„ slot eliminationã€‚

### 7.2 å€™é¸ç”Ÿæˆ

- `GenerateCandidates(activeRangeStart, activeRangeEnd)`
- ç”Ÿæˆ `slots[1..9]`

### 7.3 è² é¢éæ¿¾ï¼ˆDealbreaker-driven eliminationï¼‰

- æ ¹æ“š mapping table å°‡ã€Œè¡Œæ˜Ÿ â†’ åœ°é›·ã€å°æ‡‰åˆ°å•ç­”ã€‚
- ç¯„ä¾‹è¦å‰‡ï¼š
    - è¨å­å†·æš´åŠ› â†’ æ’é™¤ä¸ƒå®®æœ‰ Saturn çš„ slots
    - è¨å­è¡çªæš´èº â†’ æ’é™¤ä¸ƒå®®æœ‰ Mars çš„ slots
    - è¨å­æ¬ºé¨™æ€ªç™– â†’ æ’é™¤ä¸ƒå®®æœ‰ Rahu çš„ slots

### 7.4 ç´°éæ¿¾è£œå¼·ï¼šå¤–åœ¨é¢å…·æ’é™¤ï¼ˆä¸Šå‡ï¼æ™‚æŸ±çš„ Not-Me Tagï¼‰

#### 7.4.1 ä¸Šå‡æ˜Ÿåº§æ’é™¤æ³•ï¼ˆMisunderstanding Checkï¼‰

> é¡¯æ€§é¡Œç›®å•ã€Œçµ•å°ä¸å¯èƒ½çš„ç¬¬ä¸€å°è±¡ã€ã€‚å¤–è²Œç‰¹å¾µï¼ˆä¾‹å¦‚è‡‰å‹ã€é¡´éª¨ï¼‰å¯ä½œç‚ºéš±æ€§æ¬Šé‡ï¼Œä½†ä¸å¼·è¿«ä½¿ç”¨è€…è‡ªè¿°å¤–è²Œã€‚
> 
- Q: åœ¨éå¾€çš„äººç”Ÿä¸­ï¼Œåˆ¥äººå°ä½ çš„ç¬¬ä¸€å°è±¡ï¼Œå“ªä¸€å€‹æ˜¯ã€Œçµ•å°ä¸å¯èƒ½ã€ç™¼ç”Ÿçš„ï¼Ÿ
    - **é¸é … Aï¼ˆæ’é™¤ä¸Šå‡ç«è±¡å‚¾å‘ï¼‰ï¼š** è¢«èªç‚ºæ˜¯ã€Œéåº¦ç†±æƒ…ã€è¬›è©±å¾ˆå¤§è²ã€åœä¸ä¸‹ä¾†ã€çš„äººã€‚
        - è‹¥ User é¸ Aï¼ˆè¡¨ç¤ºã€Œæˆ‘çµ•ä¸å¯èƒ½è¢«èªç‚ºç†±æƒ…ã€ï¼‰ï¼šåˆªé™¤ä¸Šå‡å°„æ‰‹ã€ç…å­ã€ç‰¡ç¾Šçš„å€™é¸æ™‚æ®µã€‚
    - **é¸é … Bï¼ˆæ’é™¤ä¸Šå‡åœŸè±¡ï¼åæ…¢åš´è‚…å‚¾å‘ï¼‰ï¼š** è¢«èªç‚ºæ˜¯ã€Œåæ‡‰å¾ˆæ…¢ã€å¤ªéåš´è‚…ã€å­˜åœ¨æ„Ÿå¾ˆä½ã€çš„äººã€‚
        - è‹¥ User é¸ Bï¼ˆè¡¨ç¤ºã€Œæˆ‘çµ•ä¸å¯èƒ½è¢«èªç‚ºåš´è‚…ï¼æ…¢ã€ï¼‰ï¼šåˆªé™¤ä¸Šå‡æ‘©ç¾¯ã€é‡‘ç‰›ã€å¤©è çš„å€™é¸æ™‚æ®µã€‚

#### 7.4.2 å…«å­—æ™‚æŸ±æ’é™¤æ³•ï¼ˆCrisis Reactionï¼‰

> æ™‚æŸ±å¯è¦–ç‚ºå°å¤–è§£é¡Œæ‰‹æ®µèˆ‡æŠ—å£“åæ‡‰ã€‚ç”¨ã€Œæœ€åšä¸åˆ°çš„åæ‡‰ã€ä¾†åˆ†ç¾¤ã€‚
> 
- Q: å·¥ä½œé‡åˆ°æ¥µä¸åˆç†çš„ç¬¨è›‹éœ€æ±‚ï¼Œä½ æœ€ã€Œåšä¸åˆ°ã€çš„åæ‡‰æ˜¯ï¼Ÿ
    - **é¸é … Aï¼ˆåä¿ç•™é£Ÿå‚·ï¼ä¸ƒæ®ºå‚¾å‘ï¼‰ï¼š** ã€Œç‚ºäº†çš‡åŸå…§çš„å’Œæ°£ï¼Œé›–ç„¶ä¸çˆ½ä½†é‚„æ˜¯ç¬‘ç¬‘åœ°åä¸‹å»ç…§åšã€‚ã€
        - é£Ÿå‚·ï¼ä¸ƒæ®ºå¼·çš„äººæ›´å¸¸åšä¸åˆ°åå¿ã€‚è‹¥ User é¸ Aï¼ˆè¡¨ç¤ºåšä¸åˆ°åå¿ï¼‰ï¼Œä¿ç•™é£Ÿå‚·ï¼ä¸ƒæ®ºæ ¼çš„å€™é¸æ™‚æ®µã€‚
    - **é¸é … Bï¼ˆåä¿ç•™æ­£å®˜ï¼æ­£å°å‚¾å‘ï¼‰ï¼š** ã€Œç›´æ¥æ‹æ¡Œç¿»è‡‰ï¼Œæˆ–è€…å†·å˜²ç†±è«·å°æ–¹ä¸€é “ç„¶å¾Œæ‹’åšã€‚ã€
        - æ­£å®˜ï¼æ­£å°å¼·çš„äººæ›´å¸¸åšä¸åˆ°æ’•ç ´è‡‰ã€‚è‹¥ User é¸ Bï¼ˆè¡¨ç¤ºåšä¸åˆ°ç¿»è‡‰ï¼‰ï¼Œä¿ç•™å®˜å°æ ¼çš„å€™é¸æ™‚æ®µã€‚

### 7.5 å‹•æ…‹å‡ºé¡Œï¼ˆè³‡è¨Šå¢ç›Šæœ€å¤§åŒ–ï¼‰

- å¾ã€Œå‰©é¤˜å€™é¸ slotsã€æ‰¾å‡ºæœ€èƒ½åˆ†è£‚å€™é¸é›†åˆçš„ç‰¹å¾µï¼ŒæŒ‘ä¸‹ä¸€é¡Œã€‚
- ç›®æ¨™ï¼šç”¨æœ€å°‘é¡Œæ•¸æŠŠå€™é¸ç¸®åˆ° 1-2 å€‹ã€‚

### 7.6 è¼¸å‡º

- æ›´æ–°å‰©é¤˜å€™é¸é›†åˆï¼ˆå¯å­˜æ–¼æš«å­˜ç‹€æ…‹æˆ– event payloadï¼‰
- æ›´æ–° `activeD9Slot`ï¼ˆè‹¥åªå‰©ä¸€å€‹ï¼‰
- æ›´æ–° `status = narrowed_to_d9`

---

## 8. Step Cï¼šä¿¡å¿ƒå€¼èˆ‡é–å®šï¼ˆLocking Policyï¼‰

### 8.1 ä¿¡å¿ƒå€¼æ›´æ–°

- `currentConfidence` ç”±ä»¥ä¸‹å› ç´ ç¶œåˆï¼š
    - å‰©é¤˜å€™é¸æ•¸é‡ï¼ˆè¶Šå°‘è¶Šé«˜ï¼‰
    - ç­”æ¡ˆä¸€è‡´æ€§ï¼ˆçŸ›ç›¾è¶Šå°‘è¶Šé«˜ï¼‰
    - Boundary Caseï¼ˆè¶Šåš´é‡è¶Šä¿å®ˆï¼‰

### 8.2 é–å®šé–€æª»

- `lockThreshold = 0.8`
- ç•¶ `currentConfidence >= lockThreshold` ä¸”å€™é¸é›†åˆç©©å®šï¼š
    - `status = locked`
    - `calibratedTime = slotMidpoint`ï¼ˆæˆ–ä½ æƒ³ç”¨æ›´ä¿å®ˆçš„ `calibratedRange`ï¼‰
    - è¿½åŠ  rectificationLogï¼š`locked`

### 8.3 needs_review

- è‹¥ç­”æ¡ˆäº’ç›¸çŸ›ç›¾æˆ– Boundary Case å°è‡´ä¸ç©©å®šï¼š
    - `status = needs_review`
    - ç”±ç³»çµ±æ¡ä¿å®ˆè¼¸å‡ºï¼ˆTier é™ç´šï¼‰

---

## 9. Config èˆ‡æ¼”ç®—æ³•ï¼ˆVia Negativa Engineï¼‰

 ç›®æ¨™ï¼šæŠŠã€Œæˆ‘çµ•å°ä¸æ˜¯ï¼æˆ‘æœ€è¨å­ã€è½‰æˆå¯é‡è·‘ã€å¯è¿½è¹¤çš„éæ¿¾è¦å‰‡ï¼Œä¸¦èƒ½åœ¨å€™é¸ slots ä¸Šåš deterministic eliminationã€‚
 

### 9.1 æ ¡æ­£è¨­å®šæª”ï¼ˆconfig/rectification_negative_logic.jsonï¼‰

ç”¨ã€Œäº’æ–¥æ¨™ç±¤ã€èˆ‡ã€Œåå•é¡Œç›®ã€æè¿°ï¼šæŸé¡å€™é¸ï¼ˆä¾‹å¦‚ä¸Šå‡ç«è±¡ï¼‰*ä¸å¯èƒ½*ç¬¦åˆå“ªäº›ç‰¹è³ª
```json
{
  "Ascendant_Exclusion": {
    "Fire_Signs": {
      "cannot_be": [
        "shy",
        "slow_paced",
        "invisible"
      ],
      "question_text": "åˆ¥äººçµ•å°ä¸æœƒå½¢å®¹ä½ æ˜¯ã€å®‰éœåˆ°è®“äººå¿˜è¨˜ä½ çš„å­˜åœ¨ã€ï¼Ÿ"
    },
    "Earth_Signs": {
      "cannot_be": [
        "drama_queen",
        "impulsive",
        "clumsy"
      ],
      "question_text": "åˆ¥äººçµ•å°ä¸æœƒå½¢å®¹ä½ æ˜¯ã€æƒ…ç·’åŒ–ä¸”åšäº‹ä¸ç¶“å¤§è…¦ã€ï¼Ÿ"
    }
  },
  "Moon_Exclusion": {
    "Water_Moon": {
      "nightmare_scenario": "Emotional_Invalidation",
      "question_text": "ä¼´ä¾¶å°ä½ èªªï¼šã€åˆ¥å“­äº†ï¼Œè¬›é‚è¼¯å¥½å—ï¼Ÿã€é€™æœƒè®“ä½ ç†æ™ºæ–·ç·šå—ï¼Ÿ",
      "expected_answer": "YES"
    }
  }
}
```
### 9.2 æ¼”ç®—æ³•é‚è¼¯æ›´æ–°ï¼ˆPseudo Codeï¼‰

User ç”¨ã€Œå¦èªã€æä¾›è¨Šè™Ÿï¼ˆä¾‹å¦‚ï¼šæˆ‘çµ•å°ä¸æ˜¯ Aï¼‰ï¼Œç³»çµ±æŠŠ A å°æ‡‰åˆ° traitsï¼Œä¸¦åˆªé™¤åŒ…å«è©² traits çš„å€™é¸ slotsã€‚

```typescript
function applyNegativeFilter(candidateSlots, userResponse) {
	// userResponse: "I am definitely NOT Option A"

	// æ‰¾å‡º Option A å°æ‡‰çš„æ˜Ÿåº§ç‰¹è³ª (ä¾‹å¦‚: Option A = æ…¢éƒä¸­ = åœŸè±¡ç‰¹è³ª)
	const rejectedTraits = getTraitsFromOption(userResponse.rejectedOption);

	// éæ¿¾å€™é¸æ™‚æ®µ
	return candidateSlots.filter(slot => {
		const slotAscendant = calculateAscendant(slot.time);

		// å¦‚æœé€™å€‹æ™‚æ®µçš„ä¸Šå‡æ˜Ÿåº§ï¼ŒåŒ…å«ä½¿ç”¨è€…ã€Œæ¥µåº¦å¦èªã€çš„ç‰¹è³ªï¼Œå°±åˆªé™¤è©²æ™‚æ®µ
		// ä¾‹å¦‚ï¼šUser å¦èªè‡ªå·±æ˜¯ã€Œæ…¢éƒä¸­ã€ï¼Œä½† Slot æ˜¯ä¸Šå‡é‡‘ç‰›(æ…¢)ï¼Œå‰‡åˆªé™¤æ­¤ Slot
		if (hasTrait(slotAscendant, rejectedTraits)) {
			return false; // Eliminate
		}
		return true; // Keep
	});
}
```
## 10. Mapping Table è¦æ ¼ï¼ˆplanet_tags.jsonï¼‰

### 10.1 æª”æ¡ˆè·¯å¾‘

- `config/planet_tags.json`

### 10.2 æ ¼å¼ï¼ˆMVPï¼‰

```json
{
	"Mars": {
		"dealbreaker": "æš´åŠ›/è¡çª",
		"question": "ä½ æ˜¯å¦çµ•å°ç„¡æ³•æ¥å—ä¼´ä¾¶åµæ¶æ™‚æ‘”æ±è¥¿æˆ–æƒ…ç·’å¤±æ§ï¼Ÿ"
	},
	"Saturn": {
		"dealbreaker": "å†·æ¼ /å£“æŠ‘",
		"question": "ä½ æ˜¯å¦çµ•å°ç„¡æ³•æ¥å—ä¼´ä¾¶é•·æœŸå†·æˆ°ã€ä¸æºé€šï¼Ÿ"
	},
	"Rahu": {
		"dealbreaker": "æ¬ºé¨™/æ€ªç•°",
		"question": "ä½ æ˜¯å¦çµ•å°ç„¡æ³•æ¥å—ä¼´ä¾¶èªªè¬Šæˆæ€§æˆ–æœ‰é›£ä»¥ç†è§£çš„æ€ªç™–ï¼Ÿ"
	}
}
```

## 11. Data Confidence Tieringï¼ˆå°å¤–è¼¸å‡ºèˆ‡æ¬Šé™ï¼‰

### 11.1 Tier 3ï¼ˆåªçŸ¥é“æ—¥æœŸ / å¤§ç¯„åœï¼‰

- å¯è¼¸å‡ºï¼šæ…¢è¡Œæ˜Ÿå‚¾å‘æ¨™ç±¤ï¼ˆåƒ¹å€¼è§€ã€æºé€šé¢¨æ ¼å¤§æ–¹å‘ï¼‰
- ç¦æ­¢è¼¸å‡ºï¼šä¸Šå‡ã€å®®ä½ã€ç²¾æº–æ€§å¸å¼•åŠ›/æ·±å±¤å‹•åŠ›
- UI æ–‡æ¡ˆï¼šå¼•å°ä½¿ç”¨è€…è£œæ™‚é–“æˆ–åƒèˆ‡æ ¡æ­£é¡Œ

### 11.2 Tier 2ï¼ˆçŸ¥é“æ—©ä¸Š/ä¸‹åˆ/æ™šä¸Š æˆ–å·²ç¸®åˆ° 2hrï¼‰

- å¯è¼¸å‡ºï¼šæ¨¡ç³Šç›¤çš„å€é–“çµæœï¼ˆå¸¶ Uncertain æ¨™è¨˜ï¼‰
- è‹¥é‡æ•æ„Ÿåˆ‡æ›ï¼ˆå¦‚æœˆäº®æ›åº§ï¼‰ï¼šè§¸ç™¼ 1-2 é¡Œç¢ºèª
- **Tier å‡ç´šè¦å‰‡ï¼š** è‹¥ `rectification_status = 'locked'` ä¸” `currentConfidence >= 0.8`ï¼Œç³»çµ±è‡ªå‹•å‡æ ¼ç‚º Tier 1ï¼Œè§£é–å®Œæ•´ç›¤é¢èˆ‡é«˜ç²¾åº¦åª’åˆ

### 11.3 Tier 1ï¼ˆç²¾ç¢ºåˆ°åˆ†é˜ æˆ–å·² lockedï¼‰

- å¯è¼¸å‡ºï¼šå®Œæ•´ç›¤èˆ‡é«˜ç²¾åº¦åª’åˆé‚è¼¯
- è§£é–ï¼šæ·±åº¦åˆç›¤ã€å®®ä½ã€é€²éšäº’å‹•èˆ‡é«˜æ¬Šé‡åŒ¹é…

---

## 12. æ¨¡çµ„åˆ‡åˆ†ï¼ˆEngineeringï¼‰

### 12.1 RectificationService

è·è²¬ï¼šè™•ç†ä¸ç¢ºå®šæ™‚é–“çš„å€™é¸ç”Ÿæˆã€éæ¿¾ã€å‡ºé¡Œã€ä¿¡å¿ƒæ›´æ–°èˆ‡é–å®šã€‚

- `initializeRange(input) -> activeRange`
- `generateCandidates(activeRange) -> slots[]`
- `applyAnswers(slots, answers) -> remainingSlots`
- `selectNextQuestion(remainingSlots, mappingTable) -> question`
- `updateConfidence(state, remainingSlots) -> confidence`
- `lockIfReady(state) -> state`

### 12.2 AstrologyEngine

è·è²¬ï¼šç´”å æ˜Ÿè¨ˆç®—ã€‚

- æ¥å—å–®é»æ™‚é–“æˆ–æ™‚é–“ç¯„åœã€‚
- ç¯„åœå¯ç”¨ï¼š
    - å¹³å‡ç›¤ï¼ˆmean chartï¼‰
    - æˆ–æŠ½æ¨£ï¼ˆMonte Carloï¼‰è¼¸å‡ºä¸ç¢ºå®šæ€§

### 12.3 Astro-Service æ“´å……éœ€æ±‚ï¼ˆBoundary Detectionï¼‰

é‚Šç•Œæ¡ˆä¾‹åµæ¸¬éœ€åœ¨ `window_start` èˆ‡ `window_end` å…©å€‹æ™‚é–“é»åˆ†åˆ¥è¨ˆç®—ä¸Šå‡æ˜Ÿåº§ï¼Œæ‰èƒ½åˆ¤æ–·çª—å£å…§æ˜¯å¦ç™¼ç”Ÿ Asc/Dsc æ›åº§ã€‚

**MVP æ–¹æ¡ˆï¼ˆOption B â€” ç„¡éœ€æ–° endpointï¼‰ï¼š**
- åœ¨ `birth-data` API å…§ï¼Œä»¥ `window_start` å’Œ `window_end` å„å‘¼å«ä¸€æ¬¡ç¾æœ‰çš„ `POST /calculate-chart`
- æ¯”è¼ƒå…©æ¬¡çš„ `ascendant_sign` å›å‚³å€¼ï¼›è‹¥ä¸åŒ â†’ `is_boundary_case = true`ï¼ŒåŸå› è¨˜ç‚º `ascendant_descendant_sign_change`
- å…©æ¬¡å‘¼å«çš†ç‚ºéé˜»å¡ï¼ˆfire-and-forgetï¼‰ï¼Œæˆ–åœ¨ boundary detection é‚è¼¯å…§åŒæ­¥ç­‰å¾…å†å¯«å›

**æœªä¾†å„ªåŒ–ï¼ˆOption A â€” è¼•é‡ endpointï¼‰ï¼š**
```
POST /astro/ascendant
{ birth_date, time, lat, lng } â†’ { ascendant_sign }
```
æ•ˆèƒ½æ›´ä½³ï¼ˆä¸è¨ˆç®—å®Œæ•´æ˜Ÿç›¤ï¼‰ï¼Œé©åˆé«˜æµé‡æˆ–æ‰¹é‡é‚Šç•Œåµæ¸¬ã€‚

---

## 13. MVP é©—æ”¶æ¸…å–®ï¼ˆDefinition of Doneï¼‰

- è¨»å†Šèƒ½é¸æ“‡ 3 ç¨®å‡ºç”Ÿæ™‚é–“ç²¾åº¦ä¸¦æˆåŠŸå»ºç«‹ profileã€‚
- å¾Œç«¯èƒ½åˆå§‹åŒ– activeRange ä¸¦ç”¢ç”Ÿ rectificationLogã€‚
- èƒ½åœ¨ 2hr ç¯„åœç”¢ç”Ÿ 9 å€‹ D9 slots ä¸¦é€²è¡Œè² é¢éæ¿¾ã€‚
- èƒ½æ›´æ–° confidenceï¼Œé”é–€æª»å¾Œé–å®š calibratedTimeã€‚
- UI ä¾ Tier æ­£ç¢ºé™ç´šè¼¸å‡ºï¼Œä¸”ä¸æœƒåœ¨ä½ Tier é¡¯ç¤ºé«˜ç²¾åº¦çµè«–ã€‚

---

## 14. Rectification Quiz API ç«¯é»è¦æ ¼

### 14.1 `GET /api/rectification/next-question`

å–å¾—ç•¶å‰ä½¿ç”¨è€…çš„ä¸‹ä¸€é“æ ¡æ­£å•é¡Œã€‚

**Auth:** å¿…é ˆç™»å…¥ï¼ˆSupabase session cookieï¼‰

**Response 200:**
```typescript
interface NextQuestionResponse {
  question_id: string        // å”¯ä¸€è­˜åˆ¥ï¼Œe.g. "moon_exclusion_aries_taurus"
  phase: 'coarse' | 'fine'   // ç²—éæ¿¾ï¼ˆ2hrï¼‰or ç´°éæ¿¾ï¼ˆD9 slotï¼‰
  question_text: string      // ç¹é«”ä¸­æ–‡å•é¡Œæ–‡å­—
  options: {
    id: 'A' | 'B'
    label: string            // é¸é …æ–‡å­—
    eliminates: string[]     // è‹¥é¸æ­¤é¸é …ï¼Œæ’é™¤å“ªäº›ç‰¹è³ª/æ˜Ÿåº§ç¾¤
  }[]
  context: {
    remaining_candidates: number   // ç›®å‰å‰©é¤˜å€™é¸æ•¸
    current_confidence: number     // ç›®å‰ä¿¡å¿ƒå€¼ (0.00-1.00)
    rectification_status: RectificationStatus
    is_boundary_case: boolean
  }
}
```

**Response 204:** ä¸éœ€è¦æ›´å¤šå•é¡Œï¼ˆstatus = 'locked' æˆ– confidence å·²è¶³å¤ ï¼‰

**é¸é¡Œé‚è¼¯ï¼ˆå„ªå…ˆåº¦ï¼‰ï¼š**
1. `is_boundary_case = true` ä¸”åŸå› å« `ascendant_descendant_sign_change` â†’ å„ªå…ˆå‡º Â§7.4.1 ä¸Šå‡æ’é™¤é¡Œ
2. `is_boundary_case = true` ä¸”åŸå› å« `moon_sign_change` â†’ å„ªå…ˆå‡º Â§6.3.1 æœˆäº®å´©æ½°é¡Œ
3. `is_boundary_case = true` ä¸”åŸå› å« `bazi_hour_pillar_change` â†’ å„ªå…ˆå‡º Â§7.4.2 æ™‚æŸ±æ’é™¤é¡Œ
4. å…¶é¤˜ï¼šå¾å‰©é¤˜ D9 slots é¸å‡ºã€Œè³‡è¨Šå¢ç›Šæœ€å¤§ã€çš„å•é¡Œï¼ˆèƒ½æœ€å‡å‹»åˆ†è£‚å€™é¸é›†åˆçš„ç‰¹å¾µï¼‰

---

### 14.2 `POST /api/rectification/answer`

æäº¤ä½¿ç”¨è€…å°æ ¡æ­£å•é¡Œçš„å›ç­”ï¼Œè§¸ç™¼ Via Negativa éæ¿¾ä¸¦æ›´æ–°ç‹€æ…‹ã€‚

**Auth:** å¿…é ˆç™»å…¥

**Request Body:**
```typescript
interface AnswerRequest {
  question_id: string       // èˆ‡ GET next-question å›å‚³çš„ id å°æ‡‰
  selected_option: 'A' | 'B'
  source: 'onboarding_post' | 'daily_quiz'  // è§¸ç™¼ä¾†æº
}
```

**API Logic:**
```
1. é©—è­‰ question_id æ˜¯å¦å·²åœ¨æ­¤ session å›ç­”éï¼ˆé¿å…é‡è¤‡æäº¤ï¼‰
2. å‘¼å« applyNegativeFilter(candidateSlots, selectedOption)
   â†’ å–å¾— rejectedTraitsï¼Œéæ¿¾ candidateSlots
3. æ›´æ–° rectification_statusï¼š
   - è‹¥å‰©é¤˜ candidates è·¨è¶Š 2hr é‚Šç•Œ â†’ 'collecting_signals'
   - è‹¥æ”¶æ–‚åˆ°å–®ä¸€ 2hr å€é–“ â†’ 'narrowed_to_2hr'
   - è‹¥æ”¶æ–‚åˆ°å–®ä¸€ D9 slot â†’ 'narrowed_to_d9'
4. æ›´æ–° current_confidenceï¼ˆè¦‹ Â§8.1ï¼‰
5. è‹¥ confidence >= 0.8 â†’ lockIfReady() â†’ 'locked'ï¼Œå¯«å…¥ calibrated_time
6. è¨˜éŒ„ rectification_eventsï¼š
   {
     source,
     event_type: 'candidate_eliminated' | 'range_narrowed' | 'confidence_updated' | 'locked',
     payload: { question_id, selected_option, eliminated_slots, remaining_count, new_confidence }
   }
7. Upsert users tableï¼ˆstatusã€confidenceã€activeRangeã€calibratedTimeï¼‰
8. Return updated state
```

**Response 200:**
```typescript
interface AnswerResponse {
  rectification_status: RectificationStatus
  current_confidence: number
  remaining_candidates: number
  calibrated_time: string | null   // åªæœ‰ status='locked' æ™‚é null
  tier_upgraded: boolean           // è‹¥ Tier 2 â†’ 1 è‡ªå‹•å‡æ ¼
  next_question_available: boolean
}
```

---

## 15. æ··åˆè§¸ç™¼ç­–ç•¥ï¼ˆMixed Trigger Strategyï¼‰

> çµè«–ï¼šæ ¡æ­£å•ç­”åˆ†ä¸‰å€‹æ¥è§¸é»è§¸ç™¼ï¼Œä½æ‘©æ“¦ã€é«˜è½‰æ›ã€æ¼¸é€²æ”¶æ–‚ã€‚

### 15.1 Phase 1 â€” Onboarding å¾Œå³æ™‚è§¸ç™¼ï¼ˆç²—éæ¿¾ï¼‰

**è§¸ç™¼æ¢ä»¶ï¼š** `accuracy_type â‰  'PRECISE'`ï¼ˆTWO_HOUR_SLOT æˆ– FUZZY_DAY ç”¨æˆ¶ï¼‰

**æ™‚æ©Ÿï¼š** Step 4 éˆé­‚å ±å‘Šé è®€å–å®Œæˆå¾Œï¼Œåœ¨ã€ŒæŸ¥çœ‹ä½ çš„é…å°ã€æŒ‰éˆ•å‰æ’å…¥ 1-2 é¡Œ

**é¡Œæ•¸è¦å‰‡ï¼š**
- `is_boundary_case = true`ï¼ˆAsc/Dscï¼‰â†’ ç«‹å³å‡º 1 é¡Œä¸Šå‡æ’é™¤é¡Œï¼ˆÂ§7.4.1ï¼‰
- `accuracy_type = 'FUZZY_DAY'` unknown â†’ å‡º 2 é¡Œç²—éæ¿¾ï¼ˆæœˆäº®å´©æ½° + ç¤¾äº¤è€—èƒ½ï¼‰
- `accuracy_type = 'TWO_HOUR_SLOT'` or `FUZZY_DAY` period â†’ å‡º 1 é¡Œæœ€ç›¸é—œçš„ç²—éæ¿¾é¡Œ
- `accuracy_type = 'PRECISE'` â†’ è·³éï¼Œç›´æ¥é€²å…¥ Daily Feed

**UI åŒ…è£ï¼š**
> ã€Œé‚„æœ‰æœ€å¾Œä¸€æ­¥ï¼æ¯”èµ·å–œæ­¡ä»€éº¼ï¼Œä½ æ›´æ¸…æ¥šè‡ªå·±è¨å­ä»€éº¼â€”â€”å¹«æˆ‘å€‘æŠŠä½ çš„æ˜Ÿç›¤æ ¡æº–åˆ°æœ€ç²¾ç¢ºã€‚ã€

---

### 15.2 Phase 2 â€” Daily Feed æ¯æ—¥å•ç­”ï¼ˆç´°éæ¿¾ï¼‰

**è§¸ç™¼æ¢ä»¶ï¼š** `rectification_status â‰  'locked'`

**é »ç‡ä¸Šé™ï¼š** æ¯å€‹è‡ªç„¶æ—¥æœ€å¤š 1 é¡Œï¼ˆè¨˜éŒ„æœ€å¾Œå•ç­”æ—¥æœŸï¼Œé¿å…æ‰“æ“¾ï¼‰

**é¡¯ç¤ºä½ç½®ï¼š** Daily Feed é ‚éƒ¨ï¼Œä¸‰å¼µé…å°å¡ä¹‹å‰ï¼Œä»¥ card å½¢å¼å‘ˆç¾

**å•é¡Œä¾†æºï¼š**
- Phase 1 è‹¥æœªå®Œæˆç²—éæ¿¾ â†’ ç¹¼çºŒå‡ºç²—éæ¿¾é¡Œ
- ç²—éæ¿¾å®Œæˆå¾Œ â†’ é€²å…¥ç´°éæ¿¾ï¼ˆD9 slot æ’é™¤é¡Œï¼‰

**é€²åº¦é¡¯ç¤ºï¼š**
- Card é ‚éƒ¨é¡¯ç¤ºã€Œæ˜Ÿç›¤ç²¾æº–åº¦ã€é€²åº¦æ¢ï¼ˆ`current_confidence Ã— 100%`ï¼‰
- å­æ¨™é¡Œï¼šã€Œå†å›ç­” N é¡Œï¼Œè§£é–å®Œæ•´é…å°åˆ†æã€ï¼ˆN = ä¼°ç®—å‰©é¤˜é¡Œæ•¸ï¼‰

---

### 15.3 Phase 3 â€” Profile é ç²¾æº–åŒ–å…¥å£

**UI å…ƒä»¶ï¼š** Profile é çš„æ˜Ÿç›¤å€å¡Šå…§ï¼Œé¡¯ç¤ºã€Œæ˜Ÿç›¤ç²¾æº–åº¦ã€badge

| rectification_status | Badge | CTA |
|---------------------|-------|-----|
| `unrectified` | â¬œ å°šæœªæ ¡æ­£ | ã€Œé–‹å§‹æ ¡æ­£æ˜Ÿç›¤ã€â†’ é€²å…¥æ ¡æ­£æµç¨‹ |
| `collecting_signals` | ğŸŸ¡ æ ¡æ­£ä¸­ XX% | ã€Œç¹¼çºŒæ ¡æ­£ã€â†’ å‡ºä¸‹ä¸€é¡Œ |
| `narrowed_to_2hr` | ğŸŸ  ç¸®å°ä¸­ XX% | ã€Œç¹¼çºŒæ ¡æ­£ã€â†’ å‡º D9 é¡Œ |
| `narrowed_to_d9` | ğŸ”µ æ¥è¿‘é–å®š XX% | ã€Œå®Œæˆæ ¡æ­£ã€â†’ å‡ºæœ€å¾Œå¹¾é¡Œ |
| `locked` | âœ… å·²é–å®š | é¡¯ç¤º `calibrated_time`ï¼Œç„¡ CTA |
| `needs_review` | âš ï¸ éœ€è¦ç¢ºèª | ã€Œé‡æ–°æ ¡æ­£ã€â†’ é‡æ–°å•Ÿå‹•æµç¨‹ |

---

### 15.4 è§¸ç™¼æµç¨‹ç¸½è¦½

```
[Onboarding Step 4 å®Œæˆ]
         â†“
accuracy_type = PRECISE?
  â”œâ”€ Yes â†’ ç›´æ¥é€²å…¥ Daily Feedï¼ˆconfidence = 0.9, status = collecting_signalsï¼‰
  â””â”€ No â†’ Phase 1: å‡º 1-2 é¡Œç²—éæ¿¾
               â†“
         [é€²å…¥ Daily Feed]
               â†“ (æ¯æ—¥)
status = locked?
  â”œâ”€ Yes â†’ é¡¯ç¤ºä¸€èˆ¬ Daily Feed
  â””â”€ No â†’ Phase 2: é¡¯ç¤º 1 é“æ ¡æ­£é¡Œï¼ˆä¸Šæ–¹ cardï¼‰â†’ Daily cards
               â†“ (ä¿¡å¿ƒå€¼ç´¯ç©)
confidence >= 0.8? â†’ è‡ªå‹• lock â†’ Tier å‡æ ¼ï¼ˆå¦‚é©ç”¨ï¼‰
```