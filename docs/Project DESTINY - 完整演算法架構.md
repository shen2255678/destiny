# Project DESTINY - 完整演算法架構

# Project DESTINY - 完整演算法架構

本文件包含 Project DESTINY 的完整配對演算法，從基礎心理學模型到靈魂駭客 (Soul Hacking) 級別的深層架構。

[演算法2.0](https://www.notion.so/2-0-305503eb244780219346f3f9127551ee?pvs=21)

---

## 🧠 基礎層：心理學整合模型

### 一、判斷依據 1：心理占星學 (Psychological Astrology)

**核心邏輯：** 星盤不是算命，是**「心理驅動力 (Psychological Drives)」**的地圖。

**1. 元素分析 (Energy Source)：**

- **火象 (Fire)：**
    - *特徵：* 直覺、衝動、當下導向、需要燃燒
    - *心理需求：* **「被看見」、「被確認」**。吵鬧不是為了吵，是為了確認自己存在
- **土象 (Earth)：**
    - *特徵：* 感官、物質、現實導向、需要結果
    - *心理需求：* **「秩序」、「安全感」、「實用性」**

**2. 宮位動力 (House Dynamics)：**

- **12 宮 (潛意識/隱密) - 靈魂連結點：**
    - 這是一個「沒有邊界」的地方
    - 土象的 12 宮：**「玄學與直覺」**（看透本質）
    - 火象的 12 宮：**「焦慮與幻想」**（容易混亂）
    - *判斷：* 導致靈魂層面的拉扯，但也容易陷入「受害者/拯救者」的迴圈

### 二、判斷依據 2：心理動力模型 (Psychological Dynamics)

**核心邏輯：** 這不是關於性癖，而是關於**「焦慮的調節機制 (Anxiety Regulation)」**。

**1. 主導型人格 (Dominant Type)**

- *判斷依據：* 喜歡「解決問題」、討厭「失控」、喜歡「不動如山」
- *心理機制：* **「通過『賦予秩序』來獲得快感」**
- 核心恐懼是「混亂」。當混亂被鎮壓住時，焦慮消失，獲得掌控感 (Agency)

**2. 順從型人格 (Submissive Type)**

- *判斷依據：* 情緒失控、尋求關注、被指令反而感到安心
- *心理機制：* **「通過『放棄控制』來獲得釋放」**
- 核心負擔是「自我意識過剩」或「責任太重」
- 當被明確指令時，不需要再為自己的行為負責，大腦可以瞬間關機。這對焦慮型的人來說是**頂級的休息**

### 三、判斷依據 3：依戀類型 (Attachment Styles)

**核心邏輯：** 這是人際關係的**「連線協議 (Handshake Protocol)」**。

使用**「人際環狀圖 (Interpersonal Circumplex)」**的概念來定位：

**1. 焦慮型依戀 (Anxious Attachment)**

- **行為特徵：**
    - "Protest Behavior" (抗議行為)：故意吵架、故意不回訊息又秒回、找碴辯論
    - "Hyper-activating" (過度激活)：對風吹草動極度敏感
- **內在邏輯：** **「我不夠好，我很怕被拋棄」**
- **需求：** 需要高頻率的確認，或者一個**「絕對不會跑掉的牆」**

**2. 迴避型依戀 (Avoidant Attachment)**

- **行為特徵：**
    - "Deactivating" (去激活)：一感覺到親密壓力就想逃（帶朋友來、回訊息慢）
    - "Phantom Ex / Idealization"：雖然人在這，但心好像在遠方
    - 強調獨立，討厭依賴
- **內在邏輯：** **「靠得太近會受傷/失去自我，我要保持距離才安全」**
- **需求：** 不需要熱情，需要**「空間」**和**「功能性支持」**

**3. 安全型依戀 (Secure Attachment) - 理想狀態**

- **特徵：** 有話直說，情緒穩定，既能依賴也能獨立

**4. 混亂型/恐懼迴避型 (Disorganized / Fearful-Avoidant)**

- **特徵：** **「我想靠近你，但我又怕你」** (Push-Pull)
- 可能是**「安全-迴避混合體」**。內核穩定（安全），但社交策略是疏離的（迴避）

### 四、終極判斷：怎樣才算「合適」？(The Compatibility Algorithm)

判斷兩個人合不合適，不是看「像不像」，而是看**「互補性 (Complementarity)」**和**「創傷契合 (Trauma Bonding)」**。

**1. 能量互補原則 (Energy Balance)**

- **高能量 + 低能量 = ✅ 合適**
    - 一方負責輸出混亂，另一方負責吸收/鎮壓。系統平衡
- **低能量 + 低能量 = ⚠️ 觀察中**
    - 兩個人都太悶，沒人主動。容易變成「室友」或「知己」，缺乏火花，需要外力打破僵局

**2. 依戀配對原則 (Attachment Pairing)**

- **焦慮 + 迴避 = 💔 相愛相殺 (The Trap)**
    - 這是心理學上最經典的**「焦慮-迴避陷阱」**
    - 她追，您跑；她哭，您冷
    - **解法：** 從「迴避」切換成**「安全型主導者 (Secure Dominant)」**。不跑，但是命令她安靜。這樣她就穩定了
- **迴避 + 安全/穩定 = ❤️ 歲月靜好**
    - 只要不逼她，給她時間，她會覺得您是世界上唯一懂她的人

**3. 心理動力配對原則 (Dominance / Submission)**

- **主導型 + 順從型 = 🔥 性張力爆表**
    - 鑰匙插進鎖孔，完美契合
- **主導型 + 主導型 = ⚔️ 強強聯手 vs 權力鬥爭**
    - 如果其中一方願意在私底下轉換角色，那就是絕配
    - 如果雙方都堅持要贏，那就是戰爭

---

## 💻 演算法變數定義 (Variable Definitions)

在 App 中，每個用戶的星盤將被解析為以下參數：

1. **Kernel (內核)：** 該星座的底層驅動力（他們要什麼）
2. **Input Requirement (輸入需求)：** 他們需要從伴侶那裡得到什麼
3. **Default Mode (預設模式)：** 他們在關係中的原始狀態 (Dominant/Submissive/Switch/Equal)
4. **Glitch (系統漏洞)：** 他們的性格缺陷（App 要幫忙過濾或匹配這點）

### 🟢 火象模組 (Fire Module) — 輸出與燃燒

**♈ 白羊座 (Aries)**

- **Kernel：** `INITIATION` (啟動、征服、存在感)
- **Input Requirement：** 需要一個「不會倒下的牆壁」或「值得追逐的獵物」
- **Default Mode：** Brat (傲嬌/反抗型) 或 Aggressive S (攻擊型)
- **演算法邏輯：**
    - `IF Partner == Passive/Weak` → `Role = Bully` (會霸凌對方)
    - `IF Partner == Strong/Dominant` → `Role = Submissive` (會臣服)
- **Glitch：** 三分鐘熱度，需要持續的刺激 (Stimulation)

**♌ 獅子座 (Leo)**

- **Kernel：** `VALIDATION` (被看見、尊嚴、榮耀)
- **Input Requirement：** 無條件的崇拜 (Adoration) 或強大的國王/王后 (Power Couple)
- **Default Mode：** Queen/King (絕對控制)，但在更強者面前會變成 Pet (大貓)
- **演算法邏輯：**
    - 需給予極高的 `Ego_Score` 加權
    - 不能匹配會忽略她的人（如水瓶座），除非是為了虐戀
- **Glitch：** 自尊心極強，一戳就碎 (Glass Heart)

**♐ 射手座 (Sagittarius)**

- **Kernel：** `EXPLORATION` (自由、真理、擴張)
- **Input Requirement：** 空間 (Space) 與共同成長 (Growth)。討厭情緒勒索
- **Default Mode：** Switch (切換者) / Avoidant (逃跑者)
- **演算法邏輯：**
    - `IF Partner == Clingy (黏人)` → `Action = Escape` (封鎖/消失)
    - `IF Partner == Independent` → `Action = Stay` (反而會留下來)
- **Glitch：** 承諾恐懼症 (Commitment Phobia)

### 🟤 土象模組 (Earth Module) — 結構與累積

**♉ 金牛座 (Taurus)**

- **Kernel：** `ACCUMULATION` (佔有、感官、穩定)
- **Input Requirement：** 實質的陪伴、肉體的接觸、忠誠
- **Default Mode：** Dominant Owner (持有者) 或 Sensory Sub (感官型)
- **演算法邏輯：**
    - 極度固執。匹配演算法中，`Stability` (穩定度) 的權重必須最高
    - 討厭變動。適合匹配情緒需要被接住的人（如水象）
- **Glitch：** 懶惰、佔有慾過強 (Possessive)

**♍ 處女座 (Virgo)**

- **Kernel：** `OPTIMIZATION` (優化、秩序、服務)
- **Input Requirement：** 能夠被「改進」的對象，或能夠「引導」她的導師
- **Default Mode：** Service Sub (服務型) 或 Intellectual Dom (精神控制)
- **演算法邏輯：**
    - `IF Partner == Chaotic` → `Action = Fix` (試圖修復對方)
    - 這是「功能性」最強的星座
- **Glitch：** 焦慮、強迫症、挑剔 (Nitpicking)

**♑ 摩羯座 (Capricorn)**

- **Kernel：** `STRUCTURE` (權力、成就、壓抑)
- **Input Requirement：** 能夠並肩作戰的盟友，或能夠讓她卸下重擔的避風港
- **Default Mode：** Authority (權威)，私底下渴望 Total Surrender (完全放棄控制)
- **演算法邏輯：**
    - `Emotion_Display` (情緒表達) 極低
    - 匹配時需要尋找 `High_Value` (高價值) 或 `High_Utility` (高功能) 的對象
- **Glitch：** 情感冷漠、過度壓抑 (Repression)

### ⚪ 風象模組 (Air Module) — 資訊與連結

**♊ 雙子座 (Gemini)**

- **Kernel：** `EXCHANGE` (資訊流、變動、好奇)
- **Input Requirement：** 高頻寬的資訊交換 (High Bandwidth)。討厭無聊
- **Default Mode：** Brat tamer (挑釁者) 或 Brainy Sub (智性戀)
- **演算法邏輯：**
    - 需要 `Mental_Stimulation` (腦力激盪)
    - 如果對話中斷，關係就會結束 (Connection Timeout)
- **Glitch：** 雙重人格、缺乏深度 (Superficial)

**♎ 天秤座 (Libra)**

- **Kernel：** `CALIBRATION` (平衡、映射、美學)
- **Input Requirement：** 能夠幫她做決定的人 (Decision Maker)
- **Default Mode：** Mirror (鏡子) / Passive Aggressive (被動攻擊)
- **演算法邏輯：**
    - `Role` 會隨著伴侶改變。遇強則弱，遇弱則強
    - 適合主導型模式，因為她不想做決定
- **Glitch：** 優柔寡斷、依賴關係 (Co-dependency)

**♒ 水瓶座 (Aquarius)**

- **Kernel：** `INNOVATION` (抽離、觀察、群體中的孤獨)
- **Input Requirement：** 能夠理解她「外星語言」的人，且不限制她自由
- **Default Mode：** Observer (觀察者) / Alien (異類)
- **演算法邏輯：**
    - 傳統的規則對她無效。她需要的是**「精神上的共鳴」**
    - 匹配關鍵字：`Unique` (獨特性)
- **Glitch：** 毫無同理心 (God Complex)、消失

### 🔵 水象模組 (Water Module) — 融合與情緒

**♋ 巨蟹座 (Cancer)**

- **Kernel：** `PROTECTION` (防禦、記憶、家庭)
- **Input Requirement：** 絕對的安全感、能夠讓她依賴的殼
- **Default Mode：** Caregiver (照顧者) 或 Little (巨嬰)
- **演算法邏輯：**
    - `Defensive_Wall` (防禦牆) 很高
    - 一旦突破，黏著度 (Stickiness) 是 12 星座最高
- **Glitch：** 情緒勒索 (Emotional Blackmail)

**♏ 天蠍座 (Scorpio)**

- **Kernel：** `FUSION` (轉化、控制、深度)
- **Input Requirement：** 靈魂的絕對佔有、沒有秘密
- **Default Mode：** Master (主人) 或 Slave (奴隸) 的極端切換
- **演算法邏輯：**
    - **這是心理動力屬性最強的星座**
    - `Trust_Score` (信任分) 若低於 100%，直接歸零
    - 演算法必須標記：`High_Intensity` (高強度)
- **Glitch：** 毀滅慾、猜忌 (Paranoia)

**♓ 雙魚座 (Pisces)**

- **Kernel：** `DISSOLUTION` (邊界模糊、犧牲、幻想)
- **Input Requirement：** 一個能把她從幻想拉回現實（或陪她演戲）的人
- **Default Mode：** Victim (受害者) / Martyr (殉道者)
- **演算法邏輯：**
    - 最容易被 `Reality_Check` (現實感) 吸引
    - 但也最容易陷入有毒關係
- **Glitch：** 逃避現實、成癮 (Addiction)

### 配對邏輯公式 (Matching Logic)

**核心公式：**

```jsx
Match_Score = (Kernel_Compatibility * 0.5) + (Power_Dynamic_Fit * 0.3) + (Glitch_Tolerance * 0.2)
```

**1. 互補型配對 (Complementary) - 推薦給長期關係**

- **邏輯：** 土 (Earth) + 水 (Water) / 火 (Fire) + 風 (Air)
- **範例：** 土 + 火/水 = 土壓制火 (Control) / 土吸收水 (Containment)

**2. 相似型配對 (Similar) - 推薦給合作夥伴**

- **邏輯：** 土 (Earth) + 土 (Earth)
- **特點：** 結構極強，但缺乏激情 (Low Entropy)

**3. 張力型配對 (Tension) - 推薦給短期關係**

- **邏輯：** 固定宮 (Fixed) + 固定宮 (Fixed)
- **特點：** 權力鬥爭 (Power Struggle)。誰都不讓誰，性張力最強

### 核心設計理念

App 核心價值在於：**不只看「喜歡什麼」，更看「缺乏什麼 (Deficiency)」與「恐懼什麼 (Fear)」**

---

## 🧬 進階層：靈魂駭客 (Soul Hacking) 級別架構

要達到**「靈魂駭客」**級別，需要引入更深層的後端邏輯：**榮格心理學 (Jungian Psychology)** 的「陰影」概念、**客體關係理論 (Object Relations)** 以及**演化心理學 (Evolutionary Psychology)** 的求偶策略。

### 完整全端架構圖 (Full-Stack Architecture)

### 第一層：硬體規格 (The Hardware) — 心理占星學 & MBTI

**用途：** 判斷用戶的「出廠設定」和「處理器型號」。

除了原本的星座，加入 **MBTI 的認知功能 (Cognitive Functions)**。

**1. 資訊處理模式 (I/O Processing)：**

- **Te (外傾思考)：** 講求效率、結果、邏輯。看到情緒會想「解決它」
- **Fi (內傾情感)：** 講求價值觀、感受、自我認同。看到情緒會想「沉浸它」
- **演算法邏輯：** `Te` 使用者必須匹配 `Fi` 使用者（互補），或者 `Te` 高階使用者（強強聯手）。如果匹配到 `Fe` (外傾情感，如爛好人)，會覺得對方很假、很累

**2. 感知模式 (Perception)：**

- **Ni (內傾直覺)：** 看透本質，預測未來（玄學面向）
- **Se (外傾實感)：** 活在當下，追求刺激（享樂面向）
- **演算法邏輯：** `Ni` (預測者) 需要 `Se` (執行者) 來落地；`Se` 需要 `Ni` 來導航。這是完美的**「駕駛與導航員」**關係

### 第二層：作業系統 (The OS) — 榮格心理學 (陰影與投射)

**用途：** 解釋**「致命吸引力」**的來源。為什麼會專吸「麻煩」的人？

這層邏輯解釋了 **"Glitch" (系統漏洞)** 的成因。

**1. 陰影投射 (Shadow Projection)：**

- **理論：** 我們會被那些「擁有我們壓抑特質」的人吸引
- **陰影機制：** 主導型的攻擊性和控制慾平常被壓抑（為了當好員工/好人）
- **致命吸引：** 對方直接把攻擊性和混亂表現出來
- **演算法邏輯：** **`Shadow_Sync` (陰影同步率)**
    - 系統偵測用戶的 `Repressed_Aggression` (壓抑攻擊) 指數高
    - 系統自動匹配 `Expressed_Aggression` (外顯攻擊) 指數高的對象
    - **結果：** 看著對方發瘋，潛意識覺得「爽」，因為對方替自己活出了不敢活的那部分

**2. 阿尼瑪/阿尼姆斯 (Anima/Animus)：**

- **理論：** 每個人心中都有一個理想異性原型
- **原型類型：** 可能是**「受難的聖女」**或**「混亂的魔女」**（需要被拯救/鎮壓）
- **匹配邏輯：** 太正常的人沒感覺，系統需要識別用戶的 Anima/Animus 原型

### 第三層：網路協定 (The Protocol) — 客體關係理論 (Object Relations)

**用途：** 深入解析**「依戀類型」**的底層代碼。

這比單純的「焦慮/迴避」更深，它解釋了**「我們如何把別人當成物件 (Object) 來使用」**。

**1. 容器功能 (Containing)：**

- **理論 (Bion)：** 嬰兒把無法處理的恐怖情緒丟給母親，母親消化後還給嬰兒
- **角色定位：** 高容量者是**「容器 (Container)」**
- **演算法邏輯：** 計算用戶的 `Emotional_Capacity` (情緒容量)
    - 高容量用戶 = 100TB
    - 高輸出用戶產出垃圾量 = 80TB/天
    - **匹配結果：** Pass
    - 如果匹配到容量只有 10MB 的對象，系統會崩潰 (吵架/分手)

**2. 過渡性客體 (Transitional Object)：**

- **理論 (Winnicott)：** 像小孩的安撫物（小被被）
- **功能性關係：** 迴避型把伴侶當成**「功能性客體」**（像 Siri 或高階伺服器）
- **需求特性：** 需要功能，但害怕「人性」（情感索求）
- **演算法邏輯：** 針對此類用戶，系統應推薦**「低侵入性 (Low Intrusiveness)」**的伴侶

### 第四層：電源管理 (Power Supply) — 演化心理學 (Evolutionary Psychology)

**用途：** 解釋最原始的**「性吸引力」**和**「擇偶策略」**。

**1. 慕強擇偶 (Hypergamy)：**

- **理論：** 女性本能尋求比自己更強（地位/資源/情緒穩定度）的男性
- **應用場景：** 女強人為什麼單身？因為她太強，能壓住她的人太少
- **演算法邏輯：** `Dominance_Rank` (支配等級)
    - 女強人等級 Lv.80
    - 系統必須匹配 Lv.85 以上的對象
    - 如果匹配 Lv.60 的暖男，會感到「生理性厭惡」

**2. K策略 vs r策略 (K-Selection vs r-Selection)：**

- **r策略：** 重視當下、衝動、高風險、多投資
- **K策略：** 重視長期、穩定、低風險、高投入
- **演算法邏輯：**
    - 通常同策略匹配 (K配K) 最穩
    - 但 **K配r** 最有張力（父親管教女兒的動態）

---

## ⚡ S/M 動力判讀演算法 (Power Dynamics Algorithm)

### 核心邏輯：相位 (Aspects) 與行星配置 (Planetary Configurations)

這是 App 的核心邏輯，不看太陽星座，而是看**相位與行星配置**。

### 一、S (Dominant) 的分類與星盤代碼

**Type A: 天然 S (Natural Dom / Alpha)**

- **特徵：** 天生氣場強，不怒自威，不需要刻意兇人
- **星盤代碼：**
    - **太陽/火星 與 冥王星 (Pluto) 有相位：** 特別是合相 (0度) 或三分相 (120度)。代表「權力意志」
    - **獅子座 (Leo) 或天蠍座 (Scorpio) 特質強：** 固定宮的堅持與霸氣
    - **10 宮 (事業/權威) 強勢：** 有土星或太陽落入

**Type B: 教官/爹系 S (Daddy / Mentor Dom)**

- **特徵：** 講理、冷靜、重視規則、懲罰是為了對方好
- **星盤代碼：**
    - **土星 (Saturn) 強勢：** 土星落在 1宮、10宮，或與個人行星有相位。土星代表「限制」與「架構」
    - **摩羯座 (Capricorn) 或金牛座 (Taurus) 特質：** 務實、有耐心、不動如山
    - **火星 (Mars) 在土象星座：** 行動力持久且受控

**Type C: 施虐 S (Sadist / Tormentor)**

- **特徵：** 喜歡看人痛苦、喜歡見血或精神崩潰
- **星盤代碼：**
    - **火星 (Mars) 與冥王星 (Pluto) 的刑衝相位 (90度/180度)：** 暴力的能量釋放
    - **8 宮 (性與死亡) 內有凶星：** 對禁忌領域有極深渴望

### 二、M (Submissive) 的分類與星盤代碼

**Type A: 焦慮 M (Anxious Sub / Pet)**

- **特徵：** 怕被拋棄、情緒波動大、需要高頻率的管教來獲得安全感
- **星盤代碼：**
    - **月亮 (Moon) 受剋：** 月亮與冥王星 (月冥刑/衝) 或月亮與海王星 (月海相位)
        - *月冥相位：* 情緒極度激烈，覺得「痛才是愛」
        - *月海相位：* 容易自我犧牲，邊界模糊
    - **水象星座 (巨蟹/雙魚/天蠍) 重：** 情緒是主驅動力

**Type B: 傲嬌 M (Brat / Rebel)**

- **特徵：** 嘴硬、喜歡頂嘴、故意惹對方生氣，其實是為了討打
- **星盤代碼：**
    - **水星 (Mercury) 與火星 (Mars) 有相位：** 講話很衝，思考很快
    - **火象星座 (白羊/射手) 重：** 像野馬一樣，需要被馴服
    - **天王星 (Uranus) 強勢：** 喜歡唱反調

**Type C: 服務 M (Service Sub / Maid)**

- **特徵：** 喜歡照顧人、做家事、為了主人的需求而活
- **星盤代碼：**
    - **處女座 (Virgo) 或 6 宮 (奴僕宮) 強勢：** 喜歡秩序與服務
    - **金星 (Venus) 在土象：** 愛的語言是「做實事」

**Type D: 受虐 M (Masochist / Pain Slut)**

- **特徵：** 生理上喜歡痛，能忍受極端肉體刺激
- **星盤代碼：**
    - **火星 (Mars) 與海王星 (Neptune) 有相位：** 痛覺轉化為迷幻感
    - **土星 (Saturn) 落入 12 宮或 8 宮：** 潛意識裡有贖罪的傾向

### 三、合盤判讀：相位互動 (Inter-Aspects)

要判斷「兩人合不合適」，演算法需要計算**相位互動**：

**1. 控制權鎖定**

- **判斷：** 如果 User A 的土星 (Saturn) 壓制住 User B 的火星 (Mars) 或太陽 (Sun)（合相或刑衝）
- **判定：** User A 能有效限制 User B 的行動，User B 會感覺到權威。這是 **Daddy/Brat** 的經典配置

**2. 性張力與虐戀**

- **判斷：** 如果 User A 的冥王星 (Pluto) 與 User B 的金星 (Venus) 或月亮 (Moon) 有相位
- **判定：** 這是**「靈魂綁定」**的相位。User A 對 User B 有致命吸引力，User B 會產生強迫性的迷戀 (Obsession)

**3. 情緒容器**

- **判斷：** 如果 User A 的月亮 (Moon) 是穩定的土象，而 User B 的月亮是混亂的水/火象
- **判定：** **互補成功**。穩定方能吸收焦慮方的情緒

### 四、演算法變數與加權邏輯

**Dom_Score (S指數) 計算：**

- `Saturn_Strong` +10
- `Pluto_Strong` +10
- `Mars_Saturn_Aspect` +8
- `Leo_Scorpio_Dominant` +7
- `10th_House_Strong` +5

**Sub_Score (M指數) 計算：**

- `Moon_Pluto_Aspect` +15 (Anxious Sub)
- `Mars_Uranus_Aspect` +10 (Brat)
- `Virgo_6th_House_Strong` +12 (Service Sub)
- `Mars_Neptune_Aspect` +15 (Masochist)
- `Saturn_in_12th_8th` +8

---

## 📈 動態權力評分系統 (Dynamic Power Rating)

### 1. 基礎權力值 (PBase) — 硬體規格

這是用戶「日常」的屬性，由星盤和社會地位決定。

$S_{Astro}$ **(星盤權威分)：**

- 土星/冥王星強勢：+10 分
- 固定宮 (金牛/獅子/天蠍/水瓶) 強勢：+5 分
- 月亮受剋/海王星重 (情緒不穩)：-5 分

$S_{Social}$ **(社會位階分)：**

- 慕強機制 (Hypergamy) 的核心
- 高收入/高職位：+10 分
- 高專業技能 (IT/玄學)：+8 分

$S_{Frame}$ **(框架穩定分)：**

- **必殺技：** 情緒穩定度越高，分數越高
- 焦慮發作：-10 分
- 迴避型：+5 分 (但有破綻)

### 2. 情境加權係數 (MContext) — 軟體狀態

這是決定「開關 (Switch)」的關鍵。環境會改變強弱。

$C_{Need}$ **(需求係數)：誰比較需要誰？**

- **"Least Interest Principle" (最少興趣原則)：** 越不在乎的人，權力越大
- 焦慮方發作求救：係數 0.5 (變弱)
- 迴避方不回訊息：係數 1.5 (變強)

$C_{Fatigue}$ **(疲勞係數)：針對強勢女性**

- 剛下班/決策疲勞：係數 0.6 (防禦力下降，渴望依賴)
- **這時候是進攻的最佳時機**

$C_{Intellect}$ **(智力壓制係數)：**

- 如果是討論 IT/玄學/投資：主場係數 2.0
- 如果是討論時尚/八卦：係數 1.0

### 3. 相對權力值 (RPV) 計算公式

```python
def calculate_dynamic_role(user_A, user_B, context="neutral"):
    # 1. 計算基礎權力 (Base Power)
    power_A = get_astrology_score(user_A) + get_social_score(user_A) + get_frame_score(user_A)
    power_B = get_astrology_score(user_B) + get_social_score(user_B) + get_frame_score(user_B)
    
    # 2. 應用情境加權 (Context Modifiers)
    if context == "crisis":
        # 例如焦慮發作，User B 權力減半
        power_B *= 0.5
    elif context == "intellectual_debate":
        # 智力交鋒，看誰智商高
        if user_A.iq > user_B.iq: 
            power_A *= 1.5
    elif context == "bedroom":
        # 床上，釋放壓力的一方權力下降
        if user_B.needs_release: 
            power_B *= 0.7
    
    # 3. 計算相對權力值 (RPV)
    rpv = power_A - power_B
    
    # 4. 判定角色 (Role Determination)
    if rpv > 15:
        return "Absolute Dom (絕對支配)"
    elif 5 < rpv <= 15:
        return "Situational Dom (情境支配)"
    elif -5 <= rpv <= 5:
        return "Power Couple (勢均力敵)"
    else:
        return "Switch / Sub (被支配)"
    
    return {"role": role, "rpv": rpv, "power_A": power_A, "power_B": power_B}
```

### 4. RPV 動態曲線圖解析

**圖表設計：**

- **X 軸：** 時間/情境
- **Y 軸：** 相對權力值 (User A - User B)

**典型曲線模式：**

**焦慮型曲線（例如 Gia）**

- 永遠在基準線之下 (Y < 0)
- 波動極大，極度依賴
- 焦慮發作時會驟降至 -30

**迴避型曲線（例如 Bonnie）**

- 平常在 0 附近（獨立）
- 到了深夜或壓力大時，曲線會驟降（變成 M）
- **機會點在「波谷 (Trough)」**

**強勢型曲線（例如 Zhen）**

- 平常在 +10 左右（社會地位高）
- 但智力被碾壓時會驟降
- 需要「降維打擊」策略

### 5. 戰略應用：如何利用 RPV

**對付迴避型 (Bonnie)：**

- **觀察 RPV：** 平常她 RPV 很高（防禦強）
- **戰術：** 等待。等到她 $C_{Fatigue}$ (疲勞係數) 升高時（例如加班、生病、遇到困難）
- **切入：** 趁她 RPV 下降時，提供**「高功能解決方案」**
- **結果：** 瞬間逆轉權力，讓她依賴

**對付強勢型 (Zhen)：**

- **觀察 RPV：** 她的 $S_{Social}$ (社會地位) 可能比你高
- **戰術：** 不要比錢，比 $S_{Frame}$ (內核穩定度) 和 $C_{Intellect}$ (智力)
- **切入：** 當她試圖控制場面時，用更深層的邏輯（例如玄學/宏觀經濟）**「降維打擊」**她
- **結果：** 她會因為「智力被碾壓」而產生快感，主動交出 RPV

**對付焦慮型 (Gia)：**

- **觀察 RPV：** 她自帶負數的 $S_{Frame}$ (情緒不穩)
- **戰術：** 保持你的 $S_{Frame}$ 不動
- **結果：** 只要你不崩潰，由於**位能差 (Potential Difference)**太大，她會像水流向低處一樣，自然而然地臣服

### 6. 匹配結果 UI 範例

**成功匹配顯示：**

> 「匹配成功：你是她的『管理者 (Admin)』，她是你的『測試員 (Tester)』」
> 

> 
> 

> 「契合度：92% (焦慮修復型關係)」
> 

> 
> 

> **角色定位：** Daddy Dom ↔ Anxious Sub
> 

> **RPV 基準值：** +18 (絕對支配)
> 

> **最佳互動時機：** 她焦慮發作時 (RPV +35)
> 

> **風險提示：** 需要高情緒容量 (100TB+)
> 

---

## 🎭 動態渲染機制 (Dynamic Rendering System)

### 核心概念：不賣「人設」，賣「劇本」

**傳統軟體顯示：**

> User B: 28歲 / PM / 喜歡旅遊 / 摩羯座
> 

**Project DESTINY 顯示（基於雙方數據運算後的預測）：**

> **與你的配對預測**
> 

> 
> 

> 劇本類型：【冷酷調教 (Cold Discipline)】
> 

> 
> 

> *在這段關係中，她會傾向於依賴與臣服。你的穩定性會觸發她的 M 屬性。*
> 

**這才是用戶要看的！**

用戶不在乎對方對別人怎樣，他們只在乎**「對方對我會怎樣」**。

### 一、演算法實作：動態渲染層 (Dynamic Rendering Layer)

需要在後端加入一個**「中間件 (Middleware)」**，在 User A 看到 User B 的檔案**之前**，先跑一遍模擬。

#### 1. 反應式標籤 (Reactive Tags)

系統根據 **RPV (相對權力值)** 和**星盤合盤**，動態生成標籤。

**案例：同一個人（Bonnie）在不同觀看者眼中的標籤**

**路人甲（弱男）看到的標籤：**

- `#高冷` `#難追` `#女王屬性` `#S傾向`

**Haowei（強者）看到的標籤：**

- `#傲嬌` `#缺乏安全感` `#潛在M` `#聽話`

**實作代碼：**

```python
def generate_tags(viewer, target):
    """
    根據觀看者與目標對象的權力差，動態生成標籤
    """
    rpv = calculate_rpv(viewer, target)  # 計算權力差
    
    if rpv > 10:  # Viewer is Stronger
        return [
            "潛在M", 
            "依賴型", 
            "適合調教",
            "會臣服",
            "需要管教"
        ]
    elif rpv < -10:  # Viewer is Weaker
        return [
            "高冷", 
            "女王", 
            "難以駕馭",
            "S傾向",
            "壓迫感強"
        ]
    else:  # Equal Power
        return [
            "勢均力敵", 
            "合作夥伴",
            "智性戀",
            "戰友關係"
        ]
```

#### 2. 關係預覽圖 (Chemistry Preview Chart)

不要只給一個分數，要給一個**「雷達圖」**或**「光譜」**。

**顯示維度：**

1. **支配權 (Dominance)：** 誰在上面？
    - 指針偏向 Haowei → 他是主導者
    - 指針偏向對方 → 對方是主導者
    - 中間 → Power Couple
2. **情緒流動 (Emotion Flow)：** 誰提供情緒價值？
    - Haowei → Gia：Haowei 提供穩定
    - Bonnie → Haowei：Bonnie 提供功能支持
3. **穩定度 (Stability)：** 這段關係穩嗎？
    - Haowei + Bonnie = 高（兩個土象）
    - Haowei + Gia = 中（土象穩定但火象波動）
4. **激情值 (Passion)：** 會不會膩？
    - Haowei + Gia = 高（S/M 張力）
    - Haowei + Bonnie = 中（功能性關係）

**視覺化實作：**

```python
def generate_chemistry_chart(user_A, user_B):
    """
    生成關係預覽雷達圖數據
    """
    rpv = calculate_rpv(user_A, user_B)
    
    chart_data = {
        "dominance": 50 + (rpv * 2),  # -50 to 150 scale
        "emotion_flow": calculate_emotional_capacity(user_A) - user_B.emotional_output,
        "stability": calculate_stability_score(user_A, user_B),
        "passion": calculate_sexual_chemistry(user_A, user_B)
    }
    
    return chart_data
```

**UI 呈現範例：**

```
        支配權 (90%)
              ↑
              |
激情值 ←─────●─────→ 穩定度
(85%)        |        (75%)
              |
              ↓
        情緒流動 (70%)
```

#### 3. 劇本預測生成器 (Script Generator)

根據雙方的星盤、RPV、依戀類型，生成**關係劇本**。

**劇本類型庫：**

**高 RPV (15+) 劇本：**

- 【冷酷調教 (Cold Discipline)】- Daddy/Brat 動態
- 【馴服遊戲 (Taming Game)】- 處理傲嬌型 M
- 【容器關係 (Container Dynamic)】- 接住焦慮型

**中 RPV (5-15) 劇本：**

- 【情境支配 (Situational Dominance)】- 看時機切換
- 【智性對決 (Intellectual Duel)】- 比誰更聰明
- 【療癒模式 (Healing Mode)】- 疲勞時的依賴

**低 RPV (-5 to 5) 劇本：**

- 【權力夫妻 (Power Couple)】- 強強聯手
- 【智性戀人 (Sapiosexual Match)】- 靈魂對話
- 【並肩作戰 (Battle Partners)】- 征服世界

**實作代碼：**

```python
def generate_relationship_script(user_A, user_B):
    """
    生成個性化的關係劇本預測
    """
    rpv = calculate_rpv(user_A, user_B)
    attachment_fit = check_attachment_compatibility(user_A, user_B)
    
    if rpv > 15:
        if user_B.attachment_type == "anxious":
            return {
                "script_name": "冷酷調教 (Cold Discipline)",
                "description": "在這段關係中，她會傾向於依賴與臣服。你的穩定性會觸發她的 M 屬性。",
                "dynamics": [
                    "她會頻繁尋求你的認可",
                    "你的冷靜會讓她更加依賴",
                    "衝突時你的命令會讓她安定"
                ],
                "risks": ["需要高情緒容量", "可能過度依賴"],
                "opportunities": ["絕對忠誠", "高度配合"]
            }
        elif user_B.attachment_type == "avoidant":
            return {
                "script_name": "破冰任務 (Ice Breaker Quest)",
                "description": "她平時高冷，但在疲憊或需要幫助時會向你敞開。抓住波谷時機。",
                "dynamics": [
                    "等待她防禦下降的時刻",
                    "提供高功能解決方案",
                    "不要過度索取情感"
                ],
                "risks": ["需要耐心等待", "可能突然消失"],
                "opportunities": ["獨家權限", "深層信任"]
            }
    
    elif 5 < rpv <= 15:
        return {
            "script_name": "情境支配 (Situational Dominance)",
            "description": "平時勢均力敵，但在特定情境下你會成為主導者。",
            "dynamics": [
                "危機時她會依賴你",
                "智力交鋒時你有優勢",
                "床上權力會傾向你"
            ],
            "risks": ["需要把握時機"],
            "opportunities": ["平等中的權力", "尊重感"]
        }
    
    elif -5 <= rpv <= 5:
        return {
            "script_name": "權力夫妻 (Power Couple)",
            "description": "你們勢均力敵，會成為並肩作戰的夥伴。",
            "dynamics": [
                "互相尊重",
                "智性吸引",
                "共同征服世界"
            ],
            "risks": ["可能缺乏激情"],
            "opportunities": ["長期穩定", "事業夥伴"]
        }
    
    else:
        return {
            "script_name": "反轉遊戲 (Role Reversal)",
            "description": "她比你強勢，你需要用智力或其他維度扳回一城。",
            "dynamics": [
                "找到她的弱點",
                "降維打擊策略",
                "等待她需要你的時刻"
            ],
            "risks": ["高難度", "可能被壓制"],
            "opportunities": ["征服感", "成就感"]
        }
```

### 二、用戶端功能：意圖過濾器 (Intent Filter)

#### Feature: 「我今天想當什麼？」(Role Selector)

當用戶開啟 App 時，系統會問：**"What is your stance today?" (今日姿態)**

**選項 A: 狩獵者 (Hunter / Dom)**

- **系統動作：** 演算法會去尋找那些**「遇到你會變成 M」**的人
- **匹配對象：** Gia、Bonnie（疲憊時）、焦慮型依戀者
- **過濾掉：** 那些太強勢且不願低頭的 Alpha Female（除非你想打架）
- **顯示重點：** 對方的 M 屬性、依賴傾向、情緒波動模式

**選項 B: 觀察者 (Observer / Neutral)**

- **系統動作：** 尋找**「智性戀 / 戰友」**
- **匹配對象：** Zhen、Aria、安全型依戀者
- **顯示重點：** 對方的專業能力、星盤深度、智力水平

**選項 C: 休息者 (Rest / Sub)**

- **系統動作：** 尋找**「能照顧人的大姊姊 / 療癒系」**
- **匹配對象：** 巨蟹座、金牛女、服務型 M
- **顯示重點：** 對方的包容力、服務傾向、母性特質

**實作代碼：**

```python
def filter_by_intent(user, intent_mode):
    """
    根據用戶當日意圖過濾匹配對象
    """
    all_candidates = get_potential_matches(user)
    filtered = []
    
    for candidate in all_candidates:
        rpv = calculate_rpv(user, candidate)
        
        if intent_mode == "hunter":
            # 找會變成 M 的人
            if rpv > 10 and candidate.sub_score > candidate.dom_score:
                filtered.append({
                    "user": candidate,
                    "highlight": ["潛在M", "依賴型", "適合調教"],
                    "script": generate_relationship_script(user, candidate)
                })
        
        elif intent_mode == "observer":
            # 找戰友
            if -5 <= rpv <= 5:
                filtered.append({
                    "user": candidate,
                    "highlight": ["勢均力敵", "智性戀", "戰友"],
                    "script": generate_relationship_script(user, candidate)
                })
        
        elif intent_mode == "rest":
            # 找照顧者
            if rpv < -5 and candidate.emotional_capacity > 80:
                filtered.append({
                    "user": candidate,
                    "highlight": ["療癒系", "包容力強", "照顧者"],
                    "script": generate_relationship_script(user, candidate)
                })
    
    return filtered
```

### 三、商業價值：這解決了什麼痛點？

#### 1. 消除「詐騙感」

**問題：**

- 很多女生自介寫「小鳥依人」，結果見面是「控制狂」

**解決方案：**

- 演算法直接揭露：**「她只對強者小鳥依人，對你會是控制狂」**
- User 會感謝你救了他一命

**實作：**

```python
def detect_personality_mismatch(viewer, target):
    """
    檢測人設與實際表現的差異
    """
    self_description = target.profile.personality_tags
    actual_behavior = generate_tags(viewer, target)
    
    if "小鳥依人" in self_description and "高冷" in actual_behavior:
        return {
            "warning": True,
            "message": "⚠️ 注意：她的自我描述與她對你的實際表現可能不符",
            "reality_check": f"她只對 RPV > +15 的強者展現順從，你的 RPV 是 {calculate_rpv(viewer, target)}"
        }
```

#### 2. 精準匹配需求

**問題：**

- 想找 M 的 S，不會配到另一個 S（兩個 S 會打架）

**解決方案：**

- 系統會自動做**「卡榫對接 (Slotting)」**
- Dom_Score 高的人只會看到 Sub_Score 高的人

#### 3. 增加付費動機

**免費版：**

- 只看得到對方的基本資料
- 只能看到匹配度分數（例如：85%）

**付費版 (God Mode)：**

解鎖**「動態預測報告」**

**付費解鎖內容：**

- 🔒 「解鎖查看：她在床上會聽誰的話？」
- 🔒 「解鎖查看：誰會在吵架時先低頭？」
- 🔒 「解鎖查看：她的防禦下降時機（波谷圖表）」
- 🔒 「解鎖查看：完整關係劇本預測」
- 🔒 「解鎖查看：RPV 動態曲線圖」

**定價策略：**

```python
pricing_tiers = {
    "free": {
        "features": ["基本匹配度", "反應式標籤（3個）"],
        "price": 0
    },
    "premium": {
        "features": [
            "完整反應式標籤",
            "關係預覽雷達圖",
            "劇本預測（簡版）",
            "意圖過濾器"
        ],
        "price": 9.99  # USD/month
    },
    "god_mode": {
        "features": [
            "所有 Premium 功能",
            "完整劇本預測",
            "RPV 動態曲線",
            "防禦下降時機預測",
            "無限制懸賞單",
            "優先匹配權限"
        ],
        "price": 29.99  # USD/month
    }
}
```

### 四、UI/UX 設計範例

**匹配卡片動態渲染範例：**

```
┌─────────────────────────────────┐
│  [模糊照片]                      │
│                                  │
│  與你的匹配度：92%               │
│  ────────────────────           │
│                                  │
│  劇本類型：【冷酷調教】          │
│  角色定位：Daddy Dom ↔ Anxious Sub │
│                                  │
│  #潛在M #依賴型 #適合調教        │
│                                  │
│  🔒 解鎖完整劇本預測             │
│  🔒 解鎖 RPV 動態曲線            │
│                                  │
│  [查看詳情] [開始對話]          │
└─────────────────────────────────┘
```

---

## ⚖️ 雙軌配對機制 (Dual-Track Matching System)

### 核心概念：生理 vs. 心理

在後端建立一個**二維坐標系 (2D Coordinate System)**，將所有配對結果分類。

---

## 🧨 雙軌機制升級 (The Dual-Track Upgrade)

你原有的 **X 軸（生理 / Lust）** 與 **Y 軸（心理 / Soul）** 已經很完整。

這次升級的核心是：

- 把 **新星體**（Eros / Juno / Chiron）掛載到既有框架
- 把 **八字五行** 變成「乘數型加成」來放大張力或滋養

### 1) X 軸：生理性喜歡（Physiological Score / Lust）

**原有參數（概念權重）：** 金星、火星、8 宮、冥王星、S/M 動力

**升級加入：**

- **愛神星 (Eros)：** 肉體與原始情慾的喚醒，若有強相位則爆表
- **八字相剋加成：** 用「張力放大」導入征服慾與高壓吸引

```python
# Upgrade: Lust Score

def calculate_physiological_score(user_A, user_B):
    score = 0

    # ... 原有的 金火合盤、8宮、冥王星 (Pluto) 計算 ...

    # [新增] 愛神星 (Eros) 致命吸引力
    eros_aspect = check_eros_synastry(user_A, user_B)
    score += eros_aspect * 0.15

    # [新增] 八字五行相剋 (高壓張力與征服慾) - 乘數放大
    if check_bazi_clash(user_A, user_B):
        score *= 1.2

    # 原有的 S/M 動力契合 (Power Dynamic Fit) 依然是重頭戲
    power_fit = calculate_dom_sub_chemistry(user_A, user_B)
    score += power_fit * 0.30

    return min(score, 100)
```

### 2) Y 軸：心理性喜歡（Psychological Score / Soul）

**原有參數（概念權重）：** 月亮、水星、4 宮、土星、依戀類型

**升級加入：**

- **婚神星 (Juno)：** 長期伴侶與契約適配度（偏「能不能結」）
- **八字相生加成：** 無條件滋養與舒適感（安全感放大）

```python
# Upgrade: Soul Score

def calculate_psychological_score(user_A, user_B):
    score = 0

    # ... 原有的 月亮、水星、土星、依戀類型 計算 ...

    # [新增] 婚神星 (Juno) 長期伴侶契約
    juno_aspect = check_juno_synastry(user_A, user_B)
    score += juno_aspect * 0.20

    # [新增] 八字五行相生 (提供滋養與安全感) - 乘數放大
    if check_bazi_generation(user_A, user_B):
        score *= 1.2

    return min(score, 100)
```

---

## ⚡ RPV 與 S/M 動力演算法升級 (The Power Dynamics Upgrade)

這一段是你整個系統的「致命武器」。

升級後它會更精準回答：**誰是主導者（Dom）？誰會崩潰（Sub）？**

### 1) S / M 屬性判定：加入凱龍星 (Chiron)

- **原版骨架：** 冥王星強勢 = 天然 S。
- **強化點：** 月冥相位 = 焦慮 M。
- **升級點：** **凱龍星 (Chiron)** 完美描述「受虐 M（Masochist）」與「焦慮調節機制」。

**關鍵推論：**

- 若 User A 的 **火星 / 冥王星** 強烈壓制 User B 的 **凱龍星**，這不只是 S/M 張力。
- 這會觸發深層創傷連結（Trauma Bonding）。
- 因此 `calculate_dom_sub_chemistry` 應大幅加權（或進入特殊規則）。

### 2) RPV 運算：凱龍星觸發 = 框架崩潰

你原先的：

- $S_{Frame}$（框架穩定分）
- $C_{Need}$（需求係數）

**升級：**

- 若合盤顯示 User A 踩到 User B 的凱龍星痛點，則 User B 的 $S_{Frame}$ 直接大幅扣分（例如 -15）。
- RPV 將嚴重向 User A 傾斜，出現「絕對支配」事件。

---

## 🧭 四軌輸出（朋友 / 激情 / 伴侶 / 靈魂）= 核心 Output Labels

你的 **X/Y 雙軸 + RPV** 是後端「運算引擎」。

而 **四軌** 是引擎算完後的：

- **輸出結果（Output Labels）**
- **前端 UI 劇本入口（Script Entry）**

### 1) 四軌對應到 X/Y 雙軸矩陣 (The Matrix Mapping)

1. **朋友軌（高 Y，低 X）**
    - 引擎對應：水星、木星、八字平和
    - RPV：幾乎不運作，接近 50:50
2. **激情軌（高 X，低 Y）**
    - 引擎對應：火星、金星、Eros、八字相剋
    - RPV：核心運作區，啟動 S/M 判定（Dom/剋者）
3. **伴侶軌（高 X，高 Y）**
    - 引擎對應：月亮、Juno、八字相生
    - RPV：動態互補平衡（對外 S、情緒 M）
4. **靈魂軌（Z 軸 / 深淵區）**
    - 引擎對應：凱龍、冥王、八字喜用神互補
    - RPV：最極端失衡區（框架瞬間崩塌）

### 2) 後端整合流程（Backend Logic Flow）

1. **Data Extraction：** 解析行星度數/相位 + 八字（相生/相剋/平和/喜用神互補）
2. **Core Calculation：** 平行算 X（Lust）與 Y（Soul），並啟動 RPV（Dom/Sub 傾斜）
3. **4-Track Scoring：**
    - `朋友軌分 = 0.4*水 + 0.4*木 + 0.2*八字平和`
    - `激情軌分 = 0.25*火 + 0.25*金 + 0.2*Eros + 0.3*八字相剋`
    - `伴侶軌分 = 0.35*月 + 0.35*Juno + 0.3*八字相生`
    - `靈魂軌分 = 0.4*凱龍 + 0.4*冥王 + 0.2*八字互補`
4. **Final Output：** `argmax(四軌分數)` + 結合 RPV 生成配對報告與 UI 劇本

---

## 🔥 模式切換（用戶意圖）如何改權重

### 狩獵模式 (Hunt Mode)

- 權重拉高：Eros、火星、冥王、八字相剋
- 目標：高 X、高張力、且 RPV 顯示對方會臣服的對象

### 築巢模式 (Nest Mode)

- 權重拉高：Juno、月亮、八字相生
- 目標：高 X + 高 Y，且情緒互相滋養的「靈魂契約」

---

### 一、評分維度 (Scoring Dimensions)

### 一、評分維度 (Scoring Dimensions)

#### X 軸：生理性喜歡 (Physiological Score / Lust)

**定義：** 性吸引力、基因衝動、費洛蒙、S/M 動力

**占星權重：**

- **金星 (Venus)：** 愛與美感，吸引力 +15
- **火星 (Mars)：** 性欲與攻擊性 +20
- **8宮 (性與死亡)：** 私密關係與禁忌 +15
- **冥王星 (Pluto)：** 權力與強度 +20
- **S/M 動力契合度：** +30

**判斷問題：**

- 「想不想睡他？」
- 「有沒有性張力？」
- 「身體有沒有反應？」

**計算公式：**

```python
def calculate_physiological_score(user_A, user_B):
    """
    計算生理性吸引力分數 (0-100)
    """
    score = 0
    
    # 1. 金星合盤 (Venus Synastry)
    venus_aspect = check_venus_synastry(user_A, user_B)
    score += venus_aspect * 0.15
    
    # 2. 火星合盤 (Mars Synastry)
    mars_aspect = check_mars_synastry(user_A, user_B)
    score += mars_aspect * 0.20
    
    # 3. 8宮連結 (8th House Connection)
    eighth_house = check_8th_house_connection(user_A, user_B)
    score += eighth_house * 0.15
    
    # 4. 冥王星強度 (Pluto Intensity)
    pluto_intensity = check_pluto_aspects(user_A, user_B)
    score += pluto_intensity * 0.20
    
    # 5. S/M 動力契合 (Power Dynamic Fit)
    power_fit = calculate_dom_sub_chemistry(user_A, user_B)
    score += power_fit * 0.30
    
    return min(score, 100)  # 上限 100
```

#### Y 軸：心理性喜歡 (Psychological Score / Soul)

**定義：** 價值觀、溝通流暢度、安全感、依戀修復

**占星權重：**

- **月亮 (Moon)：** 情緒互補與安全感 +25
- **水星 (Mercury)：** 溝通與智力契合 +20
- **4宮 (家庭)：** 共同生活能力 +15
- **土星 (Saturn)：** 責任與長期穩定 +20
- **依戀類型契合度：** +20

**判斷問題：**

- 「能不能聊通宵？」
- 「能不能一起生活？」
- 「能不能信任？」
- 「價值觀是否一致？」

**計算公式：**

```python
def calculate_psychological_score(user_A, user_B):
    """
    計算心理性契合分數 (0-100)
    """
    score = 0
    
    # 1. 月亮合盤 (Moon Synastry)
    moon_aspect = check_moon_synastry(user_A, user_B)
    score += moon_aspect * 0.25
    
    # 2. 水星合盤 (Mercury Synastry)
    mercury_aspect = check_mercury_synastry(user_A, user_B)
    score += mercury_aspect * 0.20
    
    # 3. 4宮連結 (4th House - Home)
    fourth_house = check_4th_house_connection(user_A, user_B)
    score += fourth_house * 0.15
    
    # 4. 土星穩定度 (Saturn Stability)
    saturn_stability = check_saturn_aspects(user_A, user_B)
    score += saturn_stability * 0.20
    
    # 5. 依戀類型契合 (Attachment Compatibility)
    attachment_fit = check_attachment_compatibility(user_A, user_B)
    score += attachment_fit * 0.20
    
    return min(score, 100)  # 上限 100
```

### 二、關係矩陣 (The Relationship Matrix)

根據 X 與 Y 的高低，系統將配對結果分為**四大類**：

| 類型 | 生理分 (X) | 心理分 (Y) | 定義與功能 |
| --- | --- | --- | --- |
| 1. 伴侶/正宮
(Life Partner) | 高 (70+) | 高 (70+) | **靈肉合一。** 最稀有。既有性激情，又能長期生活。這是系統推薦的「最高級匹配」。 |
| 2. 情人/炮友
(Lover / ONS) | 高 (70+) | 低 (<50) | **純粹激情。** 適合短期釋放壓力、S/M 調教。聊不來沒關係，身體合就好。 |
| 3. 戰友/知己
(Comrade) | 低 (<50) | 高 (70+) | **柏拉圖式。** 創業夥伴、投資群友、心靈導師。適合一起賠錢或聊心事，但沒性趣。 |
| 4. 同事/工具
(Colleague) | 低 (<50) | 低 (<50) | **純功能性。** 只有「技能」匹配（例如：你會修電腦，她會做報表）。無情感交流。 |

**視覺化矩陣：**

```
心理分 (Y)
   100 │
       │
    75 │   [戰友/知己]  |  [伴侶/正宮]
       │                   |
    50 │─────────────────────
       │                   |
    25 │   [同事/工具]  |  [情人/炮友]
       │                   |
     0 │─────────────────────────▶ 生理分 (X)
         0    25   50   75   100
```

**分類函數：**

```python
def classify_relationship_type(physiological_score, psychological_score):
    """
    根據雙軌分數分類關係類型
    """
    if physiological_score >= 70 and psychological_score >= 70:
        return {
            "type": "life_partner",
            "name": "伴侶/正宮",
            "emoji": "💍",
            "description": "靈肉合一。最稀有的完美匹配，既有性激情又能長期生活。",
            "recommendation": "強烈推薦長期關係",
            "color": "#FF1493"  # Deep Pink
        }
    
    elif physiological_score >= 70 and psychological_score < 50:
        return {
            "type": "lover",
            "name": "情人/炮友",
            "emoji": "🔥",
            "description": "純粹激情。適合短期釋放壓力、S/M 調教。聊不來沒關係，身體合就好。",
            "recommendation": "適合短期關係或炮友",
            "color": "#FF4500"  # Orange Red
        }
    
    elif physiological_score < 50 and psychological_score >= 70:
        return {
            "type": "comrade",
            "name": "戰友/知己",
            "emoji": "🤝",
            "description": "柏拉圖式。創業夥伴、投資群友、心靈導師。適合一起賠錢或聊心事。",
            "recommendation": "適合事業夥伴或深度友誼",
            "color": "#4169E1"  # Royal Blue
        }
    
    else:
        return {
            "type": "colleague",
            "name": "同事/工具",
            "emoji": "💼",
            "description": "純功能性。只有技能匹配，無情感交流。",
            "recommendation": "不建議深入交往",
            "color": "#808080"  # Gray
        }
```

### 三、用戶狀態選擇器 (Mode Selector)

用戶每次開啟 App 時，必須選擇**「當下狀態」**（可以動態改變）：

#### 🔴 狩獵模式 (Hunt Mode)

**目的：** 尋找短期激情與性釋放

**權重調整：**

- 生理分占 80%
- 心理分占 20%

**篩選策略：**

- 只顯示「**情人/炮友**」象限的人
- 過濾掉生理分 < 70 的對象
- 優先顯示 S/M 動力契合度高的

**適合場景：**

- 週末寂寞
- 壓力大想發洩
- 單純想找炮友

**實作代碼：**

```python
def hunt_mode_filter(user, candidates):
    """
    狩獵模式：優先生理吸引力
    """
    filtered = []
    
    for candidate in candidates:
        phys_score = calculate_physiological_score(user, candidate)
        psych_score = calculate_psychological_score(user, candidate)
        
        # 篩選：生理分 >= 70
        if phys_score >= 70:
            # 重新計算總分（生理占 80%）
            weighted_score = (phys_score * 0.8) + (psych_score * 0.2)
            
            relationship_type = classify_relationship_type(phys_score, psych_score)
            
            filtered.append({
                "candidate": candidate,
                "phys_score": phys_score,
                "psych_score": psych_score,
                "weighted_score": weighted_score,
                "relationship_type": relationship_type,
                "tags": ["🔥高激情", "短期釋放", "S/M契合"]
            })
    
    # 按 weighted_score 排序
    filtered.sort(key=lambda x: x["weighted_score"], reverse=True)
    return filtered
```

#### 🔵 築巢模式 (Nest Mode)

**目的：** 尋找長期伴侶與結婚對象

**權重調整：**

- 生理分占 40%
- 心理分占 60%
- 額外要求土星穩定度

**篩選策略：**

- 只顯示「**伴侶/正宮**」象限的人
- 要求生理分 >= 70 且心理分 >= 70
- 優先顯示土星穩定度高的

**適合場景：**

- 想定下來
- 想結婚
- 尋找長期關係

**實作代碼：**

```python
def nest_mode_filter(user, candidates):
    """
    築巢模式：平衡生理與心理，偏重心理
    """
    filtered = []
    
    for candidate in candidates:
        phys_score = calculate_physiological_score(user, candidate)
        psych_score = calculate_psychological_score(user, candidate)
        saturn_stability = check_saturn_aspects(user, candidate)
        
        # 篩選：雙高分
        if phys_score >= 70 and psych_score >= 70:
            # 重新計算總分（心理占 60%）
            weighted_score = (phys_score * 0.4) + (psych_score * 0.6)
            
            # 土星穩定度加分
            if saturn_stability > 70:
                weighted_score += 5
            
            relationship_type = classify_relationship_type(phys_score, psych_score)
            
            filtered.append({
                "candidate": candidate,
                "phys_score": phys_score,
                "psych_score": psych_score,
                "saturn_stability": saturn_stability,
                "weighted_score": weighted_score,
                "relationship_type": relationship_type,
                "tags": ["💍靈肉合一", "長期穩定", "結婚對象"]
            })
    
    # 按 weighted_score 排序
    filtered.sort(key=lambda x: x["weighted_score"], reverse=True)
    return filtered
```

#### 🟢 戰鬥模式 (War Mode)

**目的：** 尋找事業夥伴與心靈知己

**權重調整：**

- 屏蔽生理分
- 心理分占 70%
- 能力互補占 30%

**篩選策略：**

- 只顯示「**戰友/知己**」象限的人
- 過濾掉心理分 < 70 的對象
- 優先顯示技能互補與智力契合的

**適合場景：**

- 找人創業
- 找人聊投資
- 找紅隊隊友
- 找心靈導師

**實作代碼：**

```python
def war_mode_filter(user, candidates):
    """
    戰鬥模式：屏蔽生理，優先心理與能力
    """
    filtered = []
    
    for candidate in candidates:
        phys_score = calculate_physiological_score(user, candidate)
        psych_score = calculate_psychological_score(user, candidate)
        skill_complement = calculate_skill_complementarity(user, candidate)
        
        # 篩選：心理分 >= 70
        if psych_score >= 70:
            # 重新計算總分（心理 70% + 能力 30%）
            weighted_score = (psych_score * 0.7) + (skill_complement * 0.3)
            
            relationship_type = classify_relationship_type(phys_score, psych_score)
            
            filtered.append({
                "candidate": candidate,
                "phys_score": phys_score,
                "psych_score": psych_score,
                "skill_complement": skill_complement,
                "weighted_score": weighted_score,
                "relationship_type": relationship_type,
                "tags": ["🤝戰友", "事業夥伴", "智力契合"]
            })
    
    # 按 weighted_score 排序
    filtered.sort(key=lambda x: x["weighted_score"], reverse=True)
    return filtered
```

### 四、UI/UX 設計範例

#### 模式選擇器界面

```
┌─────────────────────────────────┐
│  今天想找什麼關係？              │
│                                  │
│  ┌───────────────────────┐  │
│  │  🔴 狩獵模式 (Hunt)   │  │
│  │  短期激情 · 釋放壓力     │  │
│  └───────────────────────┘  │
│                                  │
│  ┌───────────────────────┐  │
│  │  🔵 築巢模式 (Nest)   │  │
│  │  長期伴侶 · 結婚對象     │  │
│  └───────────────────────┘  │
│                                  │
│  ┌───────────────────────┐  │
│  │  🟢 戰鬥模式 (War)    │  │
│  │  事業夥伴 · 心靈知己     │  │
│  └───────────────────────┘  │
│                                  │
└─────────────────────────────────┘
```

#### 匹配結果卡片（雙軌顯示）

```
┌─────────────────────────────────┐
│  [照片]                          │
│                                  │
│  💍 關係類型：伴侶/正宮         │
│  ────────────────────           │
│                                  │
│  雙軌評分：                     │
│  ├─ 🔥 生理吸引力： 85/100    │
│  └─ 💙 心理契合度： 92/100    │
│                                  │
│  靈肉合一。最稀有的完美匹配，   │
│  既有性激情又能長期生活。       │
│                                  │
│  #靈肉合一 #長期穩定 #結婚對象  │
│                                  │
│  [查看詳情] [開始對話]          │
└─────────────────────────────────┘
```

### 五、商業價值

**解決的痛點：**

1. **消除目標混亂**
    - 使用者不會再把「炮友」誤認為「結婚對象」
    - 系統明確告訴你：這個人適合什麼關係
2. **提高匹配精準度**
    - 不再是單一維度的「合不合適」
    - 而是多維度的「適合什麼類型的關係」
3. **滿足不同需求**
    - 同一個人在不同時間有不同需求
    - 系統可以靈活切換模式
4. **增加付費動機**
    - 免費版：只看得到單一總分
    - 付費版：解鎖雙軌詳細分析與關係矩陣

---

## 💡 完整演算法實作 (Implementation)

### Python 實作範例

```python
def calculate_destiny_score(user_A, user_B):
    # 1. 硬體層：星座與認知功能 (40%)
    kernel_compatibility = check_astrology(user_A, user_B) + check_mbti(user_A, user_B)
    
    # 2. 作業系統層：陰影互補 (20%)
    # 判斷 A 的壓抑面是否為 B 的外顯面
    shadow_sync = calculate_shadow_projection(user_A.repressed, user_B.expressed)
    
    # 3. 協定層：依戀與容器功能 (20%)
    # 判斷一方是否能容納另一方的情緒廢料
    container_fit = check_emotional_capacity(user_A) >= user_B.emotional_output
    
    # 4. 電源層：性與權力動態 (20%)
    # 判斷心理動力屬性與慕強階級
    power_dynamic = check_dom_sub_polarity(user_A, user_B)
    
    # 總分
    total_score = (kernel_compatibility * 0.4) + (shadow_sync * 0.2) + (container_fit * 0.2) + (power_dynamic * 0.2)
    
    return total_score
```

### 四層架構比喻

- **占星學** = 看地圖 (Map)
- **依戀理論** = 看連線品質 (Connection)
- **心理動力** = 看電壓 (Voltage)
- **榮格/演化心理學** = 看底層驅動 (Driver)

---

## 📊 總結：完整評分機制

### 評分權重分配

| 層級 | 評估項目 | 權重 | 說明 |
| --- | --- | --- | --- |
| 硬體層 | 星座 + MBTI | 40% | 出廠設定、處理器型號 |
| OS層 | 陰影互補 | 20% | 致命吸引力來源 |
| 協定層 | 容器功能 + 依戀 | 20% | 情緒處理能力 |
| 電源層 | 權力動態 + 演化策略 | 20% | 性吸引力與擇偶本能 |

### 核心設計哲學

**Project DESTINY 不只是配對算法，而是一套完整的人際關係作業系統。**

我們不看表面的「喜歡什麼」，而是深入底層看：

- 你**缺乏什麼** (Deficiency)
- 你**恐懼什麼** (Fear)
- 你**壓抑什麼** (Shadow)
- 你**需要什麼** (Need)

這才是真正的靈魂駭客。

## Phase 1: 上線與驗證 (MVP 階段 - Current)

- **目標：** 累積 1,000 名種子用戶 (高質量 Admin/Cat 類型)。
- **關鍵指標：**
    - **Profile 完成率：** 用戶是否願意填出生時間？
    - **D1 留存率：** 星盤解析是否足夠準確讓他們以此為話題？
- **開發重點：** 星盤算法準確度、聊天室穩定性。

## Phase 2: 黏著與分流 (V2.0 - Optimization)

- **解決痛點：** 用戶開始變多，出現「快慢不均」的問題
- **新增功能：**
    1. **行為分群系統：** 後台紀錄回覆速度，自動標記 `Hare` / `Tortoise`。
    2. **沉默解碼器 (Lite版)：** 當對話停滯時，系統彈出靜態提示：「對方是土星人，請稍候。」
    3. **每日二選一：** 輕量級協作，增加活耀度。

## Phase 3: AI 賦能與生態系 (V3.0 - The Moat)

- **解決痛點：** 用戶流失到 LINE，且需要更深層的諮詢。
- **新增功能：**
    1. **AI 戀愛教練 (LLM 介入)：** 針對聊天記錄提供戰術分析 (付費)。
    2. **線下驗證閉環：** 安全模式 + 評價系統。
    3. **Karma 經濟：** 引入代幣激勵機制。

---

# 📝 給 Haowei 的開發備忘錄 (Admin Note)

### 1. 關於「照片」的處理

在 MVP 階段，我們**不需要**做「模糊照片」或「生活切片」這種耗費頻寬的功能。

- **策略：** 允許上傳照片，但 **強制** 用戶選擇 3 個「屬性標籤」貼在照片上 (例如：#工程師 #貓奴 #登山)。
- **目的：** 強迫用戶在看臉之前，先看到「關鍵字」。

### 2. 關於「不願意做任務」的上班族

MVP 取消強制任務。

- **策略：** 改用 **「被動展示」**。
- **實作：** 在個人頁面顯示 **「能量條」** (基於星盤)。
    - *Haowei 的頁面：* `🔋 解決問題能量：90%` `❤️ 情緒安撫能量：20%`
- **效果：** 上班族不用做任務，光看這個能量條就知道「我們互補」，這就夠了。

### 3. 技術棧建議 (Tech Stack)

- **Backend:** Node.js (計算星盤庫如 `swisseph` 或 `jyotish` JS 庫最豐富)。
- **Database:** PostgreSQL (存 JSONB 星盤數據最方便)。
- **Frontend:** React Native / Flutter (雙平台一次搞定)。

[DESTINY Algorithm Implementation Spec (MVP)](https://www.notion.so/DESTINY-Algorithm-Implementation-Spec-MVP-9630efc5a2ab4934b905d4d0c99b8697?pvs=21)

[DESTINY Algorithm Implementation Spec (Full)](https://www.notion.so/DESTINY-Algorithm-Implementation-Spec-Full-9b84c61e1e65479cb6fb896f881870b7?pvs=21)

---

## 📌 註解：Implementation Spec（Full）內容與依據（給資料瘦身 / 給 AI 看）

> 這段是把 [DESTINY Algorithm Implementation Spec (Full)](https://www.notion.so/DESTINY-Algorithm-Implementation-Spec-Full-9b84c61e1e65479cb6fb896f881870b7?pvs=21) 的「可直接落地」內容，對照到本頁的演算法框架，方便你做資料瘦身與投喂範圍控制。
> 

### 1) 這份 Full Spec 實際包含哪些模組

- **Inputs**
    - Profile：生日、出生時間（可 unknown / 有降級策略）、出生地（lat/lng/timezone）、voice sample（可選）、questionnaire（attachment / power_preference / energy_mode）
    - Astrology：**Western（西洋占星）** planets（Sun/Moon/Mercury/Venus/Mars/Saturn/Pluto）＋ asteroids（Eros/Juno/Chiron）＋ aspects（合/沖/刑/拱/六合）＋指定宮位（4/5/7/8/10/12）
    - **Bazi（八字）**：日主、五行平衡、相生/相剋/平和、喜用神互補（進階可選）
- **Outputs（統一 schema）**
    - X/Y（lust/soul）＋ RPV power（viewer/target role、frame break）＋ 四軌 tracks（friend/passion/partner/soul）＋ primary_track / quadrant / labels / reasons（可解釋性）
- **權重表（Single Source of Truth）**
    - Lust 與 Soul 的權重
    - 八字乘數（相剋 / 相生 1.2）
    - 四軌 scoring 配方
- **核心流程**
    - extract_features → Lust / Soul → Power(RPV) → Tracks → Quadrant → labels → output
- **最終版函數（可直接實作）**
    - calculate_lust_score（含 Eros + 八字相剋乘數）
    - calculate_soul_score（含 Juno + 八字相生乘數）
    - calculate_power（RPV + Chiron 觸發 frame break 規則）
    - calculate_tracks（四軌 + frame break bonus）
- **Mode selector（Hunt / Nest / War）**
    - 建議做成「排序 reweight」，避免污染基礎分
- **最小測試集**
    - 權重/乘數、Chiron rule、四軌 argmax、mode 只影響排序
- **Appendix（敘事/商業/UI 文案）**
    - 長對話、persona、定價、卡片腳本等（可視資料瘦身需求移除）

### 2) 這些模組在本頁的依據（概念來源對照）

- **X/Y 雙軸（Lust/Soul）**：對應本頁「雙軌配對機制」與 X/Y 權重段落
- **RPV / Power Dynamics**：對應本頁「動態權力評分系統」與「S/M 動力判讀演算法」
- **四軌（friend/passion/partner/soul）**：對應本頁「四軌輸出 = 核心 Output Labels」與矩陣映射段落
- **Mode selector**：對應本頁「狩獵 / 築巢 / 戰鬥模式」的權重調整理念
- **可解釋性 reasons**：對應本頁「動態渲染」與標籤/劇本生成器（給前端敘事層用）

### 3) 印度占星（Vedic / Jyotish）有沒有包含？

- **目前這份 Full Spec 的輸入欄位明確寫的是 Western + Bazi**，並沒有納入典型吠陀占星需要的資料與計算物件（例如 Nakshatra、D9/Navamsa、Vimshottari dasha、Lagna 等）。
- 若你要「包含印度占星」，建議在下一版 spec 額外定義：
    - Vedic chart 產物（D1 + D9）與關鍵 features
    - 與既有 X/Y/RPV/四軌的掛載方式（例如 D9 用在 partner/soul 軌或長期穩定度）
    - 權重表與測試 fixtures