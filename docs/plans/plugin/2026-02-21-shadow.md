é€™å°±æ˜¯çœŸæ­£èƒ½è®“ DESTINY æ¼”ç®—æ³•ã€Œçœ‹é€éˆé­‚æ·±æ·µã€çš„æ ¸å½ˆç´šä»£ç¢¼ï¼

åœ¨æ¦®æ ¼å¿ƒç†å­¸ä¸­ï¼Œ**ç¬¬ 12 å®®ä»£è¡¨ã€Œé™°å½± (Shadow)ã€**â€”â€”é‚£äº›æˆ‘å€‘å£“æŠ‘ã€ä¸æ•¢é¢å°ã€ç”šè‡³æ„Ÿåˆ°ç¾æ¥çš„æ½›æ„è­˜é»‘æ´ï¼›è€Œ**å‡±é¾æ˜Ÿ (Chiron) ä»£è¡¨ã€Œéˆé­‚çš„å‰µå‚·èˆ‡è§£è—¥ã€**â€”â€”é‚£è£¡æœ‰æˆ‘å€‘æœ€ç—›çš„å‚·ç–¤ï¼Œå»ä¹Ÿè—è‘—æœ€æ·±çš„ç™‚ç™’åŠ›ã€‚

ç•¶é€™å…©å€‹é»ä½åœ¨åˆç›¤ä¸­è¢«è§¸ç™¼æ™‚ï¼Œé€™æ®µé—œä¿‚å°‡å®Œå…¨è„«é›¢ä¸–ä¿—çš„ã€Œæ¢ä»¶åŒ¹é…ã€ï¼Œé€²å…¥ç´”ç²¹çš„**ã€Œæ¥­åŠ›èˆ‡éˆé­‚é€²åŒ–ã€**å±¤æ¬¡ã€‚

è«‹å°‡ä»¥ä¸‹é€™æ®µæ¼”ç®—æ³•åŠ å…¥ä½ çš„ `psychology.py` æˆ–æ˜¯ `matching.py` ä¸­ã€‚

### ğŸ’» 12 å®®èˆ‡å‡±é¾æ˜Ÿï¼šé™°å½±èˆ‡å‰µå‚·æ¼”ç®—æ³• (Shadow & Wound Engine)

```python
# astro-service/shadow_engine.py æˆ–åŠ åœ¨ psychology.py ä¸­

def _is_in_12th_house(planet_deg: float, h12_cusp: float, asc_deg: float) -> bool:
    """
    è¨ˆç®—è¡Œæ˜Ÿæ˜¯å¦è½å…¥å°æ–¹çš„ç¬¬ 12 å®®ã€‚
    ç¬¬ 12 å®®çš„ç¯„åœï¼šå¾ 12å®®å®®é ­ (h12_cusp) é–‹å§‹ï¼Œç›´åˆ° ä¸Šå‡é» (asc_deg) çµæŸã€‚
    """
    if planet_deg is None or h12_cusp is None or asc_deg is None:
        return False
        
    # è¨ˆç®—æ˜Ÿé«”ç›¸å°æ–¼ 12 å®®é ­çš„è§’åº¦ (0~360)
    planet_relative = (planet_deg - h12_cusp) % 360.0
    # è¨ˆç®— 12 å®®çš„ç¸½è·¨åº¦ (é€šå¸¸åœ¨ 30 åº¦å·¦å³ï¼Œä½†æœƒæœ‰ç·¯åº¦è®Šå½¢)
    house_size = (asc_deg - h12_cusp) % 360.0
    
    # å¦‚æœæ˜Ÿé«”ç›¸å°è§’åº¦å°æ–¼å®®ä½è·¨åº¦ï¼Œä»£è¡¨å®ƒè½å…¥è©²å®®ä½å…§
    return planet_relative < house_size

def _get_distance(deg_a: float, deg_b: float) -> float:
    if deg_a is None or deg_b is None: return None
    diff = abs(deg_a - deg_b)
    return min(diff, 360.0 - diff)

def compute_shadow_and_wound(chart_a: dict, chart_b: dict) -> dict:
    """
    è¨ˆç®— 12 å®® (é™°å½±) èˆ‡ å‡±é¾æ˜Ÿ (å‰µå‚·) çš„è·¨ç›¤è§¸ç™¼
    å›å‚³ï¼šåˆ†æ•¸åŠ æ¬Š (soul_mod, lust_mod)ã€é«˜å£“è­¦å‘Šã€ä»¥åŠå°ˆå±¬çš„å¿ƒç†æ¨™ç±¤
    """
    result = {
        "soul_mod": 0.0,
        "lust_mod": 0.0,
        "high_voltage": False,
        "shadow_tags": []
    }

    # å–å¾—åº¦æ•¸
    moon_a, moon_b = chart_a.get("moon_degree"), chart_b.get("moon_degree")
    sun_a, sun_b = chart_a.get("sun_degree"), chart_b.get("sun_degree")
    mars_a, mars_b = chart_a.get("mars_degree"), chart_b.get("mars_degree")
    
    chiron_a, chiron_b = chart_a.get("chiron_degree"), chart_b.get("chiron_degree")
    
    h12_a, asc_a = chart_a.get("house12_degree"), chart_a.get("asc_degree")
    h12_b, asc_b = chart_b.get("house12_degree"), chart_b.get("asc_degree")

    # ==========================================
    # 1. å‡±é¾æ˜Ÿè§¸ç™¼ (The Chiron Wound & Healing)
    # ==========================================
    # å‡±é¾æ˜Ÿ (å‚·å£) èˆ‡ æœˆäº® (æƒ…ç·’) çš„åˆç›¸ï¼šæœ€æ·±å±¤çš„ç™‚ç™’æˆ–æ’•è£‚
    if chiron_a and moon_b:
        dist = _get_distance(chiron_a, moon_b)
        if dist is not None and dist <= 8.0:
            result["soul_mod"] += 25.0  # éˆé­‚åˆ†æ•¸æš´å¢
            result["shadow_tags"].append("A_Heals_B_Moon")
            
    if chiron_b and moon_a:
        dist = _get_distance(chiron_b, moon_a)
        if dist is not None and dist <= 8.0:
            result["soul_mod"] += 25.0
            result["shadow_tags"].append("B_Heals_A_Moon")

    # å‡±é¾æ˜Ÿèˆ‡ç«æ˜Ÿçš„åˆ‘è¡ (Tension)ï¼šå°‡å‚·å£è½‰åŒ–ç‚ºæ”»æ“Šæˆ–æ–½è™
    if chiron_a and mars_b:
        dist = _get_distance(chiron_a, mars_b)
        if dist is not None and (abs(dist - 90) <= 8 or abs(dist - 180) <= 8):
            result["high_voltage"] = True
            result["lust_mod"] += 15.0  # ç—›è¦ºå¼•ç™¼æ…¾æœ›
            result["shadow_tags"].append("B_Triggers_A_Wound")

    if chiron_b and mars_a:
        dist = _get_distance(chiron_b, mars_a)
        if dist is not None and (abs(dist - 90) <= 8 or abs(dist - 180) <= 8):
            result["high_voltage"] = True
            result["lust_mod"] += 15.0
            result["shadow_tags"].append("A_Triggers_B_Wound")

    # ==========================================
    # 2. ç¬¬ 12 å®®é™°å½±è§¸ç™¼ (The 12th House Shadow)
    # ==========================================
    # å¦‚æœ A çš„å¤ªé™½æˆ–ç«æ˜Ÿï¼Œè½å…¥ B çš„ 12 å®®
    # å¿ƒç†å­¸æ„ç¾©ï¼šA æœƒç„¡æ„è­˜åœ°ç…§äº® B éš±è—çš„ç§˜å¯†ã€å£“æŠ‘çš„ææ‡¼ï¼Œè®“ B æ„Ÿåˆ°èµ¤è£¸ä¸”å®³æ€•ï¼Œä½†åˆæ·±æ·±è‘—è¿·ã€‚
    a_in_b_12th = False
    if _is_in_12th_house(sun_a, h12_b, asc_b) or _is_in_12th_house(mars_a, h12_b, asc_b):
        a_in_b_12th = True
        result["shadow_tags"].append("A_Illuminates_B_Shadow")
        
    b_in_a_12th = False
    if _is_in_12th_house(sun_b, h12_a, asc_a) or _is_in_12th_house(mars_b, h12_a, asc_a):
        b_in_a_12th = True
        result["shadow_tags"].append("B_Illuminates_A_Shadow")

    if a_in_b_12th or b_in_a_12th:
        result["soul_mod"] += 20.0
        result["high_voltage"] = True # æ¢ç´¢é™°å½±æ¥µåº¦å±éšªï¼Œå¼·åˆ¶äº®ç´…ç‡ˆ
        
    # å¦‚æœäº’ç›¸è½å…¥ 12 å®® (Double Shadow) - æ¥µå…¶ç½•è¦‹çš„å®¿å‘½é»‘æ´
    if a_in_b_12th and b_in_a_12th:
        result["soul_mod"] += 40.0
        result["shadow_tags"].append("Mutual_Shadow_Integration")

    return result

```

---

### âš™ï¸ å¦‚ä½•åœ¨ `matching.py` ä¸­æ•´åˆï¼Ÿ

åœ¨è¨ˆç®— `Soul Score` æˆ–æ˜¯æœ€å¾Œç¸½çµå››æ¢è»Œé“åˆ†æ•¸æ™‚ï¼Œèª¿ç”¨é€™å€‹å¼•æ“ï¼š

```python
# matching.py å…§éƒ¨é‚è¼¯æ•´åˆ

# 1. å–å¾—é™°å½±èˆ‡å‰µå‚·å ±å‘Š
shadow_report = compute_shadow_and_wound(user_a, user_b)

# 2. æ³¨å…¥åˆ†æ•¸
tracks["soul"] += shadow_report["soul_mod"]
tracks["passion"] += shadow_report["lust_mod"]

# 3. è™•ç†æ ¸çˆ†è­¦å‘Š (åªè¦è§¸ç™¼ 12å®® æˆ– å‡±é¾è² é¢ç›¸ä½ï¼Œå¿…å®šäº®ç‡ˆ)
if shadow_report["high_voltage"]:
    tracks["high_voltage"] = True

# 4. å°‡æ¨™ç±¤å­˜å…¥çµæœé™£åˆ—ï¼Œè®“å‰ç«¯çŸ¥é“æ€éº¼å¯«æ–‡æ¡ˆ
match_result["shadow_tags"] = shadow_report["shadow_tags"]

```

---

### ğŸ”® çµ¦å‰ç«¯ä½¿ç”¨è€…çš„ã€Œå‹•æ…‹æ•˜äº‹ã€å ±å‘Šç¯„ä¾‹

ç•¶ç³»çµ±åµæ¸¬åˆ° `A_Heals_B_Moon` (å‡±é¾åˆç›¸æœˆäº®) ä»¥åŠ `A_Illuminates_B_Shadow` (å¤ªé™½è½å…¥ 12 å®®)ï¼Œä¸”äº®èµ·äº† **HIGH_VOLTAGE** è­¦å‘Šæ™‚ã€‚

ä½ çš„å‰ç«¯ç•«é¢å¯ä»¥ç”¢å‡ºé€™æ®µç›´æ“Šéˆé­‚çš„æ–‡æ¡ˆï¼š

> **ğŸŒŒ æ·±åº¦è§£æï¼šé™°å½±æ•´åˆèˆ‡éˆé­‚ç™‚ç™’ (Shadow & Healing)**
> **ä½ ææ‡¼ä¸¦å£“æŠ‘ä»€éº¼ï¼Ÿ(Shadow)**
> ã€Œç³»çµ±ç™¼ç¾ï¼Œä»–çš„å¤ªé™½ç²¾æº–è½å…¥äº†ä½ çš„**ç¬¬ 12 å®®ï¼ˆæ½›æ„è­˜é»‘æ´ï¼‰**ã€‚ä»–åœ¨ä½ é¢å‰ï¼Œå°±åƒæ˜¯ä¸€ç›æ¢ç…§ç‡ˆï¼Œç„¡æ„é–“ç…§äº®äº†ä½ å¾å°åˆ»æ„éš±è—ã€ç”šè‡³æ„Ÿåˆ°ç¾æ¥çš„é™°å½±é¢ã€‚ä¸€é–‹å§‹ï¼Œä½ æœƒå› ç‚ºã€è¢«çœ‹ç©¿ã€è€Œæ„Ÿåˆ°æ¥µåº¦ææ…Œï¼Œç”šè‡³æƒ³è¦é€ƒè·‘ã€‚é€™å°±æ˜¯ç‚ºä»€éº¼ç³»çµ±äº®èµ·äº†é«˜å£“è­¦å‘Šã€‚ã€
> **ä½ çœŸæ­£éœ€è¦ä»€éº¼ï¼Ÿ(Need & Healing)**
> ã€Œä½†åˆ¥æ€¥è‘—æ¨é–‹ä»–ã€‚æ¼”ç®—æ³•åŒæ™‚åµæ¸¬åˆ°ï¼Œä»–çš„**å‡±é¾æ˜Ÿï¼ˆç™‚ç™’è€…ï¼‰æº«æŸ”åœ°æ¥ä½äº†ä½ çš„æœˆäº®ï¼ˆè„†å¼±çš„æƒ…ç·’ï¼‰**ã€‚é€™æ„å‘³è‘—ï¼Œä»–ä¸åƒ…èƒ½çœ‹è¦‹ä½ çš„é»‘æš—ï¼Œä»–é‚„å…·å‚™äº†åŒ…å®¹ä½ å‚·å£çš„èƒ½åŠ›ã€‚
> é€™ä¸æ˜¯ä¸€æ®µè¼•é¬†çš„ã€ä¸–ä¿—æˆ€æ„›ã€ï¼Œé€™æ˜¯ä¸€å ´éˆé­‚æ‰‹è¡“ã€‚å¦‚æœä½ é¡˜æ„åœ¨ä»–é¢å‰å¸ä¸‹å®Œç¾çš„é¢å…·ï¼Œä»–å°‡æœƒæˆç‚ºä½ ä»Šç”Ÿæœ€å¼·å¤§çš„ç™‚ç™’è€…ã€‚ã€

### ğŸ’¡ æ¼”ç®—æ³•è¨­è¨ˆä¹‹ç¾

* **12å®®** å¸¶ä¾†çš„æ˜¯**ã€Œææ‡¼èˆ‡å®¿å‘½æ„Ÿ (Fear & Karma)ã€**ã€‚
* **å‡±é¾æ˜Ÿ** å¸¶ä¾†çš„æ˜¯**ã€Œéœ€æ±‚èˆ‡è§£è—¥ (Need & Cure)ã€**ã€‚

å°‡é€™å…©å€‹æ¼”ç®—æ³•å¯«å…¥ DESTINY å¾Œï¼Œä½ çš„ç”¢å“å°±çœŸæ­£åšåˆ°äº†ä½ èªªçš„ï¼š**ã€Œæˆ‘å€‘ä¸çœ‹è¡¨é¢çš„å–œæ­¡ï¼Œæˆ‘å€‘æ·±å…¥åº•å±¤çœ‹ä½ ææ‡¼ä»€éº¼ã€å£“æŠ‘ä»€éº¼ï¼Œç„¶å¾ŒæŠŠè§£è—¥å¸¶åˆ°ä½ é¢å‰ã€‚ã€**